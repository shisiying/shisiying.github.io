<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="努力，奋斗！"><title>memcached学习笔记 | 其斤.匕禾页</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">memcached学习笔记</h1><a id="logo" href="/.">其斤.匕禾页</a><p class="description">永远相信美好的事情即将发生</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="https://www.xhzyxed.cn/"><i class="fa fa-user"> 关于</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">memcached学习笔记</h1><div class="post-meta">Sep 7, 2018<span> | </span><span class="category"><a href="/categories/memcached/">memcached</a></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#什么是memcached？"><span class="toc-number">1.</span> <span class="toc-text">什么是memcached？</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#安装"><span class="toc-number">1.1.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#重要启动项"><span class="toc-number">1.2.</span> <span class="toc-text">重要启动项</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#连接"><span class="toc-number">1.3.</span> <span class="toc-text">连接</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#基础操作"><span class="toc-number">1.4.</span> <span class="toc-text">基础操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#增"><span class="toc-number">1.4.1.</span> <span class="toc-text">增</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#删"><span class="toc-number">1.4.2.</span> <span class="toc-text">删</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#查"><span class="toc-number">1.4.3.</span> <span class="toc-text">查</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#改"><span class="toc-number">1.4.4.</span> <span class="toc-text">改</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#清空"><span class="toc-number">1.4.5.</span> <span class="toc-text">清空</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#incr-decr命令：增加-减少值的大小"><span class="toc-number">1.4.6.</span> <span class="toc-text">incr,decr命令：增加/减少值的大小</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#统计信息"><span class="toc-number">1.4.7.</span> <span class="toc-text">统计信息</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#memcached内存分配机制"><span class="toc-number">2.</span> <span class="toc-text">memcached内存分配机制</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#内存的碎片化"><span class="toc-number">2.1.</span> <span class="toc-text">内存的碎片化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#memcached的Slab-Allocator分配机制"><span class="toc-number">2.2.</span> <span class="toc-text">memcached的Slab Allocator分配机制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Slab-Allocator的基本原理"><span class="toc-number">2.2.1.</span> <span class="toc-text">Slab Allocator的基本原理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Page为内存分配的最小单位"><span class="toc-number">2.2.1.1.</span> <span class="toc-text">Page为内存分配的最小单位</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Slabs划分数据空间"><span class="toc-number">2.2.1.2.</span> <span class="toc-text">Slabs划分数据空间</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Chunk才是存放缓存数据的单位"><span class="toc-number">2.2.1.3.</span> <span class="toc-text">Chunk才是存放缓存数据的单位</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Slab的内存分配"><span class="toc-number">2.2.1.4.</span> <span class="toc-text">Slab的内存分配</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Memcached内存分配策略"><span class="toc-number">2.2.1.5.</span> <span class="toc-text">Memcached内存分配策略</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#固定大小chunk带来的内存浪费"><span class="toc-number">2.2.1.6.</span> <span class="toc-text">固定大小chunk带来的内存浪费</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#memcached的过期机制和删除机制"><span class="toc-number">2.2.1.7.</span> <span class="toc-text">memcached的过期机制和删除机制</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#惰性删除"><span class="toc-number">2.2.1.7.1.</span> <span class="toc-text">惰性删除</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#LRU删除机制"><span class="toc-number">2.2.1.7.2.</span> <span class="toc-text">LRU删除机制</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#memcached分布式"><span class="toc-number">3.</span> <span class="toc-text">memcached分布式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#分布式算法之取模算法"><span class="toc-number">3.1.</span> <span class="toc-text">分布式算法之取模算法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#代码实现取模算法"><span class="toc-number">3.1.1.</span> <span class="toc-text">代码实现取模算法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#取模算法的缺陷"><span class="toc-number">3.1.2.</span> <span class="toc-text">取模算法的缺陷</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#分布式算法之致性哈希算法"><span class="toc-number">3.2.</span> <span class="toc-text">分布式算法之致性哈希算法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#某节点down后的变化情况-对其他节点的影响"><span class="toc-number">3.2.1.</span> <span class="toc-text">某节点down后的变化情况,对其他节点的影响</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#一致性哈希算法的改进–增加虚拟结点"><span class="toc-number">3.2.2.</span> <span class="toc-text">一致性哈希算法的改进–增加虚拟结点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#代码实现一般一致性哈希算法"><span class="toc-number">3.2.3.</span> <span class="toc-text">代码实现一般一致性哈希算法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#代码实现支持虚拟节点的一致性哈希算法"><span class="toc-number">3.2.4.</span> <span class="toc-text">代码实现支持虚拟节点的一致性哈希算法</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#取模以及一致性哈希命中率对比"><span class="toc-number">4.</span> <span class="toc-text">取模以及一致性哈希命中率对比</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#准备"><span class="toc-number">4.1.</span> <span class="toc-text">准备</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#操作"><span class="toc-number">4.2.</span> <span class="toc-text">操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#初始化数据"><span class="toc-number">4.2.1.</span> <span class="toc-text">初始化数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#开启服务，访问index-html"><span class="toc-number">4.2.2.</span> <span class="toc-text">开启服务，访问index.html</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#模拟down一个结点，访问数据"><span class="toc-number">4.2.3.</span> <span class="toc-text">模拟down一个结点，访问数据</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#效果"><span class="toc-number">4.3.</span> <span class="toc-text">效果</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#取模算法"><span class="toc-number">4.4.</span> <span class="toc-text">取模算法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#一致性哈希效率"><span class="toc-number">4.4.1.</span> <span class="toc-text">一致性哈希效率</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#总结"><span class="toc-number">4.4.2.</span> <span class="toc-text">总结</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#源码"><span class="toc-number">4.4.3.</span> <span class="toc-text">源码</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#缓存雪崩现象"><span class="toc-number">5.</span> <span class="toc-text">缓存雪崩现象</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#缓存雪崩解决方案"><span class="toc-number">5.1.</span> <span class="toc-text">缓存雪崩解决方案</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#缓存的无底洞现象"><span class="toc-number">6.</span> <span class="toc-text">缓存的无底洞现象</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#原因"><span class="toc-number">6.1.</span> <span class="toc-text">原因</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#解决方案"><span class="toc-number">6.2.</span> <span class="toc-text">解决方案</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#永久数据被踢现象"><span class="toc-number">7.</span> <span class="toc-text">永久数据被踢现象</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#原因-1"><span class="toc-number">7.1.</span> <span class="toc-text">原因</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#官方解决方法："><span class="toc-number">7.2.</span> <span class="toc-text">官方解决方法：</span></a></li></ol></li></ol></div></div><div class="post-content"><p>完整的memcached基础知识以及必须知道的问题，了解一下</p>
<a id="more"></a>
<h1 id="什么是memcached？"><a href="#什么是memcached？" class="headerlink" title="什么是memcached？"></a>什么是memcached？</h1><blockquote>
<p>memcached is a high-performance, distributed memory object caching system, generic in nature, but originally intended for use in<br>speeding up dynamic web applications by alleviating database load.</p>
</blockquote>
<p>memcached是一个高性能,分布式内存对象缓存系统,具备通用性,但本来的目的是用于为动态web程序加速,并减轻数据库的的负担</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><ul>
<li>windows安装</li>
</ul>
<p>在windows下安装,相对简单,<br>Memcached官网：<a href="http://memcached.org" target="_blank" rel="noopener">http://memcached.org</a><br>从官方网站下载相应的二进制文件,<br>解压到磁盘即可</p>
<ul>
<li>linux安装</li>
</ul>
<p>libevent官网：<a href="http://libevent.org/" target="_blank" rel="noopener">http://libevent.org/</a><br>Memcached官网：<a href="http://memcached.org" target="_blank" rel="noopener">http://memcached.org</a></p>
<p>•  安装 libevent(memcached依赖libevent)<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># tar zxvf libevent-2.0.1-stable.tar.gz</span></span><br><span class="line"><span class="comment"># cd libevent-2.0.21-stable</span></span><br><span class="line"><span class="comment"># ./configure --prefix=/usr</span></span><br><span class="line"><span class="comment"># make</span></span><br><span class="line"><span class="comment"># make install</span></span><br></pre></td></tr></table></figure></p>
<p>• 安装 Memcached</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># tar zxvf memcached-1.4.15.tar.gz</span></span><br><span class="line"><span class="comment"># cd memcached-1.4.15</span></span><br><span class="line"><span class="comment"># ./configure --prefix=/usr/local</span></span><br><span class="line"><span class="comment"># make</span></span><br><span class="line"><span class="comment"># make install</span></span><br></pre></td></tr></table></figure>
<h2 id="重要启动项"><a href="#重要启动项" class="headerlink" title="重要启动项"></a>重要启动项</h2><ul>
<li>-p <num>             监听的TCP端口 (缺省: 11211)</num></li>
<li>-d                          以守护进程方式运行Memcached</li>
<li>-u <username>    运行Memcached的账户，非root用户</username></li>
<li>-m <num>           最大的内存使用, 单位是MB，缺省是 64 MB</num></li>
<li>-c <num>             软连接数量, 缺省是 1024</num></li>
<li>-v                          输出警告和错误信息</li>
<li>-vv                        打印客户端的请求和返回信息</li>
<li>-h                          打印帮助信息</li>
<li>-i                           打印memcached和libevent的版权信息</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$安装路径\memcached.exe -m 32 --vv -p 11211</span><br></pre></td></tr></table></figure>
<h2 id="连接"><a href="#连接" class="headerlink" title="连接"></a>连接</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">telnet localhost 11211</span><br></pre></td></tr></table></figure>
<h2 id="基础操作"><a href="#基础操作" class="headerlink" title="基础操作"></a>基础操作</h2><h3 id="增"><a href="#增" class="headerlink" title="增"></a>增</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">add key flag expiretime bytes\r\n</span><br><span class="line">data\r\n</span><br></pre></td></tr></table></figure>
<ul>
<li>key 给值起一个独特的名字</li>
<li>flag 标志，1是字符串，2反转数组，3，反序列化对象</li>
<li>expire 有效期（可以设置秒数，时间戳，设置为0，不自动失效，默认为30天）</li>
<li>length 缓存的长度（字节为单位）</li>
</ul>
<h3 id="删"><a href="#删" class="headerlink" title="删"></a>删</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">delete key</span><br></pre></td></tr></table></figure>
<h3 id="查"><a href="#查" class="headerlink" title="查"></a>查</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">get key</span><br></pre></td></tr></table></figure>
<h3 id="改"><a href="#改" class="headerlink" title="改"></a>改</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">replace key flag expiretime bytes\r\n</span><br><span class="line">data\r\n</span><br></pre></td></tr></table></figure>
<p>已存在的可以用replace进行替换，更改</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> key flag expiretime bytes\r\n</span><br><span class="line">data\r\n</span><br></pre></td></tr></table></figure>
<p>键不存在则新增，键存在则修改</p>
<h3 id="清空"><a href="#清空" class="headerlink" title="清空"></a>清空</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flush_all</span><br></pre></td></tr></table></figure>
<h3 id="incr-decr命令：增加-减少值的大小"><a href="#incr-decr命令：增加-减少值的大小" class="headerlink" title="incr,decr命令：增加/减少值的大小"></a>incr,decr命令：增加/减少值的大小</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">incr/decr key num</span><br></pre></td></tr></table></figure>
<h3 id="统计信息"><a href="#统计信息" class="headerlink" title="统计信息"></a>统计信息</h3><p>把当前的运行信息统计出来</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stats</span><br></pre></td></tr></table></figure>
<h1 id="memcached内存分配机制"><a href="#memcached内存分配机制" class="headerlink" title="memcached内存分配机制"></a>memcached内存分配机制</h1><h2 id="内存的碎片化"><a href="#内存的碎片化" class="headerlink" title="内存的碎片化"></a>内存的碎片化</h2><p>在向操作系统申请和释放内存时，形成了一些很小的内存片，这些内存片段无法再利用的现象称为内训的碎片化</p>
<h2 id="memcached的Slab-Allocator分配机制"><a href="#memcached的Slab-Allocator分配机制" class="headerlink" title="memcached的Slab Allocator分配机制"></a>memcached的Slab Allocator分配机制</h2><h3 id="Slab-Allocator的基本原理"><a href="#Slab-Allocator的基本原理" class="headerlink" title="Slab Allocator的基本原理"></a>Slab Allocator的基本原理</h3><p>Slab Allocator的基本原理是按照预先规定的大小，将分配的内存分割成特定长度的块，以完全解决内存碎片问题。Slab Allocation的原理相当简单。 将分配的内存分割成各种尺寸的块（chunk），并把尺寸相同的块分成组（chunk的集合）</p>
<p><img src="slab.png" alt=""></p>
<h4 id="Page为内存分配的最小单位"><a href="#Page为内存分配的最小单位" class="headerlink" title="Page为内存分配的最小单位"></a>Page为内存分配的最小单位</h4><p>Memcached的内存分配以page为单位，默认情况下一个page是1M，可以通过-I参数在启动时指定。如果需要申请内存时，memcached会划分出一个新的page并分配给需要的slab区域。page一旦被分配在重启前不会被回收或者重新分配</p>
<h4 id="Slabs划分数据空间"><a href="#Slabs划分数据空间" class="headerlink" title="Slabs划分数据空间"></a>Slabs划分数据空间</h4><p>Memcached并不是将所有大小的数据都放在一起的，而是预先将数据空间划分为一系列slabs，默认是1m，每个slab只负责一定范围内的数据存储。如下图，每个slab只存储大于其上一个slab的size并小于或者等于自己最大size的数据。例如：slab 3只存储大小介于137 到 224 bytes的数据。如果一个数据大小为230byte将被分配到slab 4中。从下图可以看出，每个slab负责的空间其实是不等的，memcached默认情况下下一个slab的最大值为前一个的1.25倍，这个可以通过修改-f参数来修改增长比例。 </p>
<h4 id="Chunk才是存放缓存数据的单位"><a href="#Chunk才是存放缓存数据的单位" class="headerlink" title="Chunk才是存放缓存数据的单位"></a>Chunk才是存放缓存数据的单位</h4><p>Chunk是一系列固定的内存空间，这个大小就是管理它的slab的最大存放大小。例如：slab 1的所有chunk都是104byte，而slab 4的所有chunk都是280byte。chunk是memcached实际存放缓存数据的地方，因为chunk的大小固定为slab能够存放的最大值，所以所有分配给当前slab的数据都可以被chunk存下。如果时间的数据大小小于chunk的大小，空余的空间将会被闲置，这个是为了防止内存碎片而设计的。例如下图，chunk size是224byte，而存储的数据只有200byte，剩下的24byte将被闲置。 </p>
<h4 id="Slab的内存分配"><a href="#Slab的内存分配" class="headerlink" title="Slab的内存分配"></a>Slab的内存分配</h4><p>Memcached在启动时通过-m指定最大使用内存，但是这个不会一启动就占用，是随着需要逐步分配给各slab的。如果一个新的缓存数据要被存放，memcached首先选择一个合适的slab，然后查看该slab是否还有空闲的chunk，如果有则直接存放进去；如果没有则要进行申请。slab申请内存时以page为单位，所以在放入第一个数据，无论大小为多少，都会有1M大小的page被分配给该slab。申请到page后，slab会将这个page的内存按chunk的大小进行切分，这样就变成了一个chunk的数组，在从这个chunk数组中选择一个用于存储数据。如下图，slab 1和slab 2都分配了一个page，并按各自的大小切分成chunk数组</p>
<h4 id="Memcached内存分配策略"><a href="#Memcached内存分配策略" class="headerlink" title="Memcached内存分配策略"></a>Memcached内存分配策略</h4><p>memcached的内存分配策略就是：按slab需求分配page，各slab按需使用chunk存储。<br>这里有几个特点要注意，</p>
<ul>
<li>Memcached分配出去的page不会被回收或者重新分配</li>
<li>Memcached申请的内存不会被释放</li>
<li>slab空闲的chunk不会借给任何其他slab使用</li>
</ul>
<p>Memcached在启动时通过-m参数指定最大使用内存，但是这个不会一启动就占用完，而是逐步分配给各slab的。如果一个新的数据要被存放，首先选择一个合适的slab，然后查看该slab是否还有空闲的chunk，如果有则直接存放进去；如果没有则要进行申请，slab申请内存时以page为单位，无论大小为多少，都会有1M大小的page被分配给该slab（该page不会被回收或者重新分配，永远都属于该slab）。申请到page后，slab会将这个page的内存按chunk的大小进行切分，这样就变成了一个chunk的数组，再从这个chunk数组中选择一个用于存储数据。若没有空闲的page的时候，则会对改slab进行LRU，而不是对整个memcache进行LRU</p>
<ul>
<li>n（最小分配空间）：即初始chunk的大小，默认是48，此时初始chunk的大小是96，（注意并不是2倍的关系，当设置为50时，第一个chunk的大小是104），-n越大slab越少。</li>
<li>slab的数量最大是200(当指定-f 1.0001)时，增长因子越大，slab越少，-f  不能小于1。</li>
</ul>
<h4 id="固定大小chunk带来的内存浪费"><a href="#固定大小chunk带来的内存浪费" class="headerlink" title="固定大小chunk带来的内存浪费"></a>固定大小chunk带来的内存浪费</h4><p>将100字节的数据缓存到122字节的chunk中剩余的22字节就浪费了<br>知道了这些以后，就可以理解为什么总内存没有被全部占用的情况下，memcached却出现了丢失缓存数据的问题了</p>
<h4 id="memcached的过期机制和删除机制"><a href="#memcached的过期机制和删除机制" class="headerlink" title="memcached的过期机制和删除机制"></a>memcached的过期机制和删除机制</h4><h5 id="惰性删除"><a href="#惰性删除" class="headerlink" title="惰性删除"></a>惰性删除</h5><ul>
<li>当某个值过期后，并没有从内存删除，因为，stats统计时，curr_item有其信息</li>
<li>当某个新值去占用他的位置时，当成空chunk来占用</li>
<li>当get值时，判断是否过期，如果过期，返回空，并且清空，curr_item就减少了</li>
</ul>
<p>这个过期，对于用户来说，访问不到，但并没有在过期的瞬间立即从内存删除</p>
<h5 id="LRU删除机制"><a href="#LRU删除机制" class="headerlink" title="LRU删除机制"></a>LRU删除机制</h5><p>若果以122byte大小的chunk举例，122的chunk都满了，又有新的长度为120的值要加入，要挤掉谁？</p>
<p>memcached用的是最近最少使用算法来挤掉被占用的chunk</p>
<p>原理：当某个单元被请求时，维护一个计数器，通过计数器来判断最近谁最少被使用，就把谁踢出。</p>
<h1 id="memcached分布式"><a href="#memcached分布式" class="headerlink" title="memcached分布式"></a>memcached分布式</h1><p>memcached虽然称为“分布式”缓存服务器，但服务器端并没有“分布式”功能。Memcache集群主机不能够相互通信传输数据，它的“分布式”是基于客户端的程序逻辑算法进一步实现的</p>
<p><img src="分布式.png" alt=""></p>
<h2 id="分布式算法之取模算法"><a href="#分布式算法之取模算法" class="headerlink" title="分布式算法之取模算法"></a>分布式算法之取模算法</h2><p>最容易想到的算法是取模算法，即N个节点要从0-&gt;N-1编号<br>key对N取模，余i,则key落在第i台服务器上</p>
<p><img src="取模.png" alt=""></p>
<h3 id="代码实现取模算法"><a href="#代码实现取模算法" class="headerlink" title="代码实现取模算法"></a>代码实现取模算法</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">/**</span><br><span class="line"> * Created by PhpStorm.</span><br><span class="line"> * User: seven</span><br><span class="line"> * Date: 2018/9/8</span><br><span class="line"> * Time: 14:04</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">interface <span class="built_in">hash</span>&#123;</span><br><span class="line"></span><br><span class="line">    //将key的字符串转换成为整数</span><br><span class="line">    public <span class="keyword">function</span> _hash(<span class="variable">$str</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface distribution&#123;</span><br><span class="line">    //查找键值所对应的服务器node的结点位置</span><br><span class="line">    public <span class="keyword">function</span> lookup(<span class="variable">$key</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class ModClass implements <span class="built_in">hash</span>,distribution&#123;</span><br><span class="line"></span><br><span class="line">    protected <span class="variable">$_nodes</span>=[];//节点数组</span><br><span class="line">    protected <span class="variable">$_count</span>=0;//结点的个数</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">function</span> _hash(<span class="variable">$str</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">return</span> sprintf(<span class="string">"%u"</span>,crc32(<span class="variable">$str</span>));//把字符串转成32位符号整数</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">function</span> lookup(<span class="variable">$key</span>)&#123;</span><br><span class="line">        <span class="variable">$location</span> = <span class="variable">$this</span>-&gt;_hash(<span class="variable">$key</span>)%<span class="variable">$this</span>-&gt;_count;</span><br><span class="line">        <span class="built_in">return</span> <span class="variable">$this</span>-&gt;_nodes[<span class="variable">$location</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">function</span> addNode(<span class="variable">$node</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(in_array(<span class="variable">$node</span>,<span class="variable">$this</span>-&gt;_nodes))&#123;</span><br><span class="line">            <span class="built_in">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$this</span>-&gt;_nodes[] =<span class="variable">$node</span>;</span><br><span class="line">        <span class="variable">$this</span>-&gt;_count+=1;</span><br><span class="line">        <span class="built_in">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">function</span> delNode(<span class="variable">$node</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(!in_array(<span class="variable">$node</span>,<span class="variable">$this</span>-&gt;_nodes))&#123;</span><br><span class="line">            <span class="built_in">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$key</span> = array_search(<span class="variable">$node</span>,<span class="variable">$this</span>-&gt;_nodes);</span><br><span class="line">        <span class="built_in">unset</span>(<span class="variable">$this</span>-&gt;_nodes[<span class="variable">$key</span>]);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$this</span>-&gt;_count-=1;</span><br><span class="line">        <span class="built_in">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$mod</span> = new ModClass();</span><br><span class="line"><span class="variable">$mod</span>-&gt;addNode(<span class="string">'a'</span>);</span><br><span class="line"><span class="variable">$mod</span>-&gt;addNode(<span class="string">'b'</span>);</span><br><span class="line"><span class="variable">$mod</span>-&gt;addNode(<span class="string">'c'</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"当前的键计算的hash落点是"</span>.<span class="variable">$mod</span>-&gt;_hash(<span class="string">'title'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$mod</span>-&gt;lookup(<span class="string">'title'</span>);</span><br></pre></td></tr></table></figure>
<h3 id="取模算法的缺陷"><a href="#取模算法的缺陷" class="headerlink" title="取模算法的缺陷"></a>取模算法的缺陷</h3><p><img src="缺陷.png" alt=""></p>
<h2 id="分布式算法之致性哈希算法"><a href="#分布式算法之致性哈希算法" class="headerlink" title="分布式算法之致性哈希算法"></a>分布式算法之致性哈希算法</h2><p>一致性hash算法除了计算key的hash值外，还会计算每个server对应的hash值，然后将这些hash值映射到一个有限的值域上（比如0~2^32）。通过寻找hash值大于hash(key)的最小server作为存储该key数据的目标server。如果找不到，则直接把具有最小hash值的server作为目标server。</p>
<p>为了方便理解，可以把这个有限值域理解成一个环，值顺时针递增。</p>
<p><img src="一致性哈希.png" alt=""></p>
<h3 id="某节点down后的变化情况-对其他节点的影响"><a href="#某节点down后的变化情况-对其他节点的影响" class="headerlink" title="某节点down后的变化情况,对其他节点的影响"></a>某节点down后的变化情况,对其他节点的影响</h3><p><img src="一致性哈希对其他节点的影响.png" alt=""></p>
<h3 id="一致性哈希算法的改进–增加虚拟结点"><a href="#一致性哈希算法的改进–增加虚拟结点" class="headerlink" title="一致性哈希算法的改进–增加虚拟结点"></a>一致性哈希算法的改进–增加虚拟结点</h3><p><img src="虚拟结点.png" alt=""></p>
<h3 id="代码实现一般一致性哈希算法"><a href="#代码实现一般一致性哈希算法" class="headerlink" title="代码实现一般一致性哈希算法"></a>代码实现一般一致性哈希算法</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">   </span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">hash</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">_hash</span><span class="params">($str)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">distribution</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">lookup</span><span class="params">($key)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Consistent</span> <span class="keyword">implements</span> <span class="title">hash</span>,<span class="title">distribution</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> $_nodes=[];</span><br><span class="line"></span><br><span class="line">    <span class="comment">//对key进行转换</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">_hash</span><span class="params">($str)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sprintf(<span class="string">"%u"</span>,crc32($str));<span class="comment">//把字符串转成32位符号整数</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//计算key所操作的node服务器</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">lookup</span><span class="params">($key)</span></span>&#123;</span><br><span class="line">        $point = <span class="keyword">$this</span>-&gt;_hash($key);</span><br><span class="line">        $node = current(<span class="keyword">$this</span>-&gt;_nodes);<span class="comment">//先取圆环上最小的一个结点，当成结果</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">foreach</span> (<span class="keyword">$this</span>-&gt;_nodes <span class="keyword">as</span> $k=&gt;$v)&#123;</span><br><span class="line">            <span class="keyword">if</span> ($point&lt;=$k)&#123;</span><br><span class="line">                $node=$v;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> $node;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//增加服务器</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">addNode</span><span class="params">($node)</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;_nodes[<span class="keyword">$this</span>-&gt;_hash($node)] =$node;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;_sortNode();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//对node进行排序，很重要的操作</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">_sortNode</span><span class="params">()</span></span>&#123;</span><br><span class="line">        ksort(<span class="keyword">$this</span>-&gt;_nodes,SORT_REGULAR);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getNodes</span><span class="params">()</span></span>&#123;</span><br><span class="line">        print_r(<span class="keyword">$this</span>-&gt;_nodes);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$consistentObj = <span class="keyword">new</span> Consistent();</span><br><span class="line"></span><br><span class="line">$consistentObj-&gt;addNode(<span class="string">'a'</span>);</span><br><span class="line">$consistentObj-&gt;addNode(<span class="string">'b'</span>);</span><br><span class="line">$consistentObj-&gt;addNode(<span class="string">'c'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">"所有服务器的结点如下"</span>.$consistentObj-&gt;getNodes();</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">"当前的键计算的hash落点是"</span>.$consistentObj-&gt;_hash(<span class="string">'name'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> $consistentObj-&gt;lookup(<span class="string">'name'</span>);</span><br></pre></td></tr></table></figure>
<h3 id="代码实现支持虚拟节点的一致性哈希算法"><a href="#代码实现支持虚拟节点的一致性哈希算法" class="headerlink" title="代码实现支持虚拟节点的一致性哈希算法"></a>代码实现支持虚拟节点的一致性哈希算法</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">interface <span class="built_in">hash</span>&#123;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">function</span> _hash(<span class="variable">$str</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface distribution&#123;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">function</span> lookup(<span class="variable">$key</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Consistent implements <span class="built_in">hash</span>,distribution &#123;</span><br><span class="line"></span><br><span class="line">    protected <span class="variable">$_position</span>=[];</span><br><span class="line">    protected <span class="variable">$_nodes</span>=[];</span><br><span class="line"></span><br><span class="line">    protected <span class="variable">$_mul</span> =64;//每个节点对应64个虚节点</span><br><span class="line"></span><br><span class="line">    //对key进行转换</span><br><span class="line">    public <span class="keyword">function</span> _hash(<span class="variable">$str</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">return</span> sprintf(<span class="string">"%u"</span>,crc32(<span class="variable">$str</span>));//把字符串转成32位符号整数</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //计算key所操作的node服务器</span><br><span class="line">    public <span class="keyword">function</span> lookup(<span class="variable">$key</span>)&#123;</span><br><span class="line">        <span class="variable">$point</span> = <span class="variable">$this</span>-&gt;_hash(<span class="variable">$key</span>);</span><br><span class="line">        <span class="variable">$node</span> = current(<span class="variable">$this</span>-&gt;_position);//先取圆环上最小的一个结点，当成结果</span><br><span class="line"></span><br><span class="line">        foreach (<span class="variable">$this</span>-&gt;_position as <span class="variable">$k</span>=&gt;<span class="variable">$v</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$point</span>&lt;=<span class="variable">$k</span>)&#123;</span><br><span class="line">                <span class="variable">$node</span>=<span class="variable">$v</span>;</span><br><span class="line">                <span class="built_in">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        reset(<span class="variable">$this</span>-&gt;_position);</span><br><span class="line">        <span class="built_in">return</span> <span class="variable">$node</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    //增加服务器</span><br><span class="line">    public <span class="keyword">function</span> addNode(<span class="variable">$node</span>)&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (isset(<span class="variable">$this</span>-&gt;_nodes[<span class="variable">$node</span>]))&#123;</span><br><span class="line">            <span class="built_in">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span>=0;<span class="variable">$i</span>&lt;<span class="variable">$this</span>-&gt;_mul;<span class="variable">$i</span>++)&#123;</span><br><span class="line">            <span class="variable">$pos</span> = <span class="variable">$this</span>-&gt;_hash(<span class="variable">$node</span>.<span class="string">'-'</span>.<span class="variable">$i</span>);</span><br><span class="line">            <span class="variable">$this</span>-&gt;_position[<span class="variable">$pos</span>]=<span class="variable">$node</span>;</span><br><span class="line">            <span class="variable">$this</span>-&gt;_nodes[<span class="variable">$node</span>][]=<span class="variable">$pos</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$this</span>-&gt;_sortPos();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //对node进行排序，很重要的操作</span><br><span class="line">    public <span class="keyword">function</span> <span class="function"><span class="title">_sortPos</span></span>()&#123;</span><br><span class="line">        ksort(<span class="variable">$this</span>-&gt;_position,SORT_REGULAR);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">function</span> delNode(<span class="variable">$node</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span> (!isset(<span class="variable">$this</span>-&gt;_nodes[<span class="variable">$node</span>]))&#123;</span><br><span class="line">            <span class="built_in">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        foreach (<span class="variable">$this</span>-&gt;_nodes[<span class="variable">$node</span>] as <span class="variable">$k</span>)&#123;</span><br><span class="line">            <span class="built_in">unset</span>(<span class="variable">$this</span>-&gt;_position[<span class="variable">$k</span>]);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">unset</span>(<span class="variable">$this</span>-&gt;_nodes[<span class="variable">$node</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public <span class="keyword">function</span> <span class="function"><span class="title">getNodes</span></span>()&#123;</span><br><span class="line">        print_r(<span class="variable">$this</span>-&gt;_position);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$consistentObj</span> = new Consistent();</span><br><span class="line"></span><br><span class="line"><span class="variable">$consistentObj</span>-&gt;addNode(<span class="string">'a'</span>);</span><br><span class="line"><span class="variable">$consistentObj</span>-&gt;addNode(<span class="string">'b'</span>);</span><br><span class="line"><span class="variable">$consistentObj</span>-&gt;addNode(<span class="string">'c'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"所有服务器的结点如下"</span>.<span class="variable">$consistentObj</span>-&gt;getNodes();</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"当前的键计算的hash落点是"</span>.<span class="variable">$consistentObj</span>-&gt;_hash(<span class="string">'name'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$consistentObj</span>-&gt;lookup(<span class="string">'name'</span>);</span><br></pre></td></tr></table></figure>
<h1 id="取模以及一致性哈希命中率对比"><a href="#取模以及一致性哈希命中率对比" class="headerlink" title="取模以及一致性哈希命中率对比"></a>取模以及一致性哈希命中率对比</h1><h2 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h2><p>开启五个memcached进程<br>以windows为例：cmd下多开窗口<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">memcached.exe -m 4 -p 11211 -vvv </span><br><span class="line">memcached.exe -m 4 -p 11212 -vvv </span><br><span class="line">memcached.exe -m 4 -p 11213 -vvv </span><br><span class="line">memcached.exe -m 4 -p 11214 -vvv </span><br><span class="line">memcached.exe -m 4 -p 11215 -vvv</span><br></pre></td></tr></table></figure></p>
<p>以下是源码文件：</p>
<ul>
<li>calStats.php 统计命中率</li>
<li>config.php 结点配置</li>
<li>delNodeReqquest.php ，模拟down一个服务器结点获取数据的过程</li>
<li>Distribute.php 取模和一致性哈希算法的实现</li>
<li>index.html 图表页面</li>
<li>InitData.php 根据所配置的算法初始化memmcached数据</li>
</ul>
<h2 id="操作"><a href="#操作" class="headerlink" title="操作"></a>操作</h2><h3 id="初始化数据"><a href="#初始化数据" class="headerlink" title="初始化数据"></a>初始化数据</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php InitData.php</span><br></pre></td></tr></table></figure>
<p>初始化数据后</p>
<h3 id="开启服务，访问index-html"><a href="#开启服务，访问index-html" class="headerlink" title="开启服务，访问index.html"></a>开启服务，访问index.html</h3><p>在源码目录下使用php内置web服务<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php -S localhost:8000</span><br></pre></td></tr></table></figure></p>
<p>浏览器页面访问localhost:8000<br>就可以看到图表曲线在跳动</p>
<h3 id="模拟down一个结点，访问数据"><a href="#模拟down一个结点，访问数据" class="headerlink" title="模拟down一个结点，访问数据"></a>模拟down一个结点，访问数据</h3><h2 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h2><h2 id="取模算法"><a href="#取模算法" class="headerlink" title="取模算法"></a>取模算法</h2><p> <img src="取模效率.png" alt=""></p>
<h3 id="一致性哈希效率"><a href="#一致性哈希效率" class="headerlink" title="一致性哈希效率"></a>一致性哈希效率</h3><p> <img src="一致性哈希效率.png" alt=""></p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p><img src="总结.png" alt=""></p>
<h3 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h3><p>calStats.php<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">/**</span><br><span class="line"> * Created by PhpStorm.</span><br><span class="line"> * User: seven</span><br><span class="line"> * Date: 2018/9/8</span><br><span class="line"> * Time: 14:32</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 统计各节点的平均命中率</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">require (<span class="string">'./config.php'</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$mem</span> = new memcache();</span><br><span class="line"></span><br><span class="line"><span class="variable">$_gets</span> =0;</span><br><span class="line"><span class="variable">$_hits</span> =0;</span><br><span class="line"></span><br><span class="line">foreach (<span class="variable">$_mem</span> as <span class="variable">$k</span>=&gt;<span class="variable">$v</span>)&#123;</span><br><span class="line">    <span class="variable">$mem</span>-&gt;connect(<span class="variable">$v</span>[<span class="string">'host'</span>],<span class="variable">$v</span>[<span class="string">'port'</span>],2);</span><br><span class="line">    <span class="variable">$stats</span> = <span class="variable">$mem</span>-&gt;getStats();</span><br><span class="line"></span><br><span class="line">    <span class="variable">$_gets</span> += <span class="variable">$stats</span>[<span class="string">'cmd_get'</span>];</span><br><span class="line">    <span class="variable">$_hits</span> += <span class="variable">$stats</span>[<span class="string">'get_hits'</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$rate</span> =1;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_gets</span>&gt;0)&#123;</span><br><span class="line">    <span class="variable">$rate</span> = <span class="variable">$_hits</span>/<span class="variable">$_gets</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$rate</span>;</span><br></pre></td></tr></table></figure></p>
<p>config.php<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">/**</span><br><span class="line"> * Created by PhpStorm.</span><br><span class="line"> * User: seven</span><br><span class="line"> * Date: 2018/9/8</span><br><span class="line"> * Time: 13:46</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//配置文件，配置memcahced的结点信息</span><br><span class="line"><span class="variable">$_mem</span> = [];</span><br><span class="line"><span class="variable">$_mem</span>[<span class="string">'A'</span>] = [<span class="string">'host'</span>=&gt;<span class="string">'127.0.0.1'</span>,<span class="string">'port'</span>=&gt;<span class="string">'11211'</span>];</span><br><span class="line"><span class="variable">$_mem</span>[<span class="string">'B'</span>] = [<span class="string">'host'</span>=&gt;<span class="string">'127.0.0.1'</span>,<span class="string">'port'</span>=&gt;<span class="string">'11212'</span>];</span><br><span class="line"><span class="variable">$_mem</span>[<span class="string">'C'</span>] = [<span class="string">'host'</span>=&gt;<span class="string">'127.0.0.1'</span>,<span class="string">'port'</span>=&gt;<span class="string">'11213'</span>];</span><br><span class="line"><span class="variable">$_mem</span>[<span class="string">'D'</span>] = [<span class="string">'host'</span>=&gt;<span class="string">'127.0.0.1'</span>,<span class="string">'port'</span>=&gt;<span class="string">'11214'</span>];</span><br><span class="line"><span class="variable">$_mem</span>[<span class="string">'E'</span>] = [<span class="string">'host'</span>=&gt;<span class="string">'127.0.0.1'</span>,<span class="string">'port'</span>=&gt;<span class="string">'11215'</span>];</span><br><span class="line"></span><br><span class="line">//分配策略</span><br><span class="line"><span class="variable">$_dis</span> = <span class="string">'Consistent'</span>;//Consistent;</span><br></pre></td></tr></table></figure></p>
<p>delNodeReqquest.php<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">/**</span><br><span class="line"> * Created by PhpStorm.</span><br><span class="line"> * User: seven</span><br><span class="line"> * Date: 2018/9/8</span><br><span class="line"> * Time: 14:44</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 模拟减少结点的请求</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">require (<span class="string">'./config.php'</span>);</span><br><span class="line">require (<span class="string">'./Distribute.php'</span>);</span><br><span class="line"><span class="variable">$mem</span> = new memcache();//实例化memcache操作类</span><br><span class="line"></span><br><span class="line"><span class="variable">$dis</span> = new <span class="variable">$_dis</span>(); //实例化分布式算法类</span><br><span class="line"></span><br><span class="line">//循环的添加服务器</span><br><span class="line">foreach(<span class="variable">$_mem</span> as <span class="variable">$k</span>=&gt;<span class="variable">$v</span>)&#123;</span><br><span class="line">    <span class="variable">$dis</span>-&gt;addNode(<span class="variable">$k</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//模拟减少一台服务器</span><br><span class="line"><span class="variable">$dis</span>-&gt;delNode(<span class="string">'D'</span>);</span><br><span class="line"></span><br><span class="line">//循环的命中memcached</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=1;<span class="variable">$i</span>&lt;10000;<span class="variable">$i</span>++)&#123;</span><br><span class="line">    <span class="variable">$i</span> = sprintf(<span class="string">'%04d'</span>,<span class="variable">$i</span>%1000);</span><br><span class="line">    <span class="variable">$keyNode</span> = <span class="variable">$dis</span>-&gt;lookup(<span class="string">'key'</span>.<span class="variable">$i</span>); //根据key计算key所属的的节点</span><br><span class="line">    <span class="variable">$mem</span>-&gt;connect(<span class="variable">$_mem</span>[<span class="variable">$keyNode</span>][<span class="string">'host'</span>],<span class="variable">$_mem</span>[<span class="variable">$keyNode</span>][<span class="string">'port'</span>],2);</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable">$mem</span>-&gt;get(<span class="string">'key'</span>.<span class="variable">$i</span>))&#123;</span><br><span class="line">        <span class="variable">$mem</span>-&gt;add(<span class="string">'key'</span>.<span class="variable">$i</span>,<span class="string">'value'</span>.<span class="variable">$i</span>,0,0); //没命中，则添加入memcache</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$mem</span>-&gt;close();</span><br><span class="line">    usleep(3000);//睡眠一段时间</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Distribute.php<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">/**</span><br><span class="line"> * Created by PhpStorm.</span><br><span class="line"> * User: seven</span><br><span class="line"> * Date: 2018/9/8</span><br><span class="line"> * Time: 13:49</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">interface <span class="built_in">hash</span>&#123;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">function</span> _hash(<span class="variable">$str</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface distribution&#123;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">function</span> lookup(<span class="variable">$key</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class ModClass implements <span class="built_in">hash</span>,distribution&#123;</span><br><span class="line"></span><br><span class="line">    protected <span class="variable">$_nodes</span>=[];//节点数组</span><br><span class="line">    protected <span class="variable">$_count</span>=0;//结点的个数</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">function</span> _hash(<span class="variable">$str</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">return</span> sprintf(<span class="string">"%u"</span>,crc32(<span class="variable">$str</span>));//把字符串转成32位符号整数</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">function</span> lookup(<span class="variable">$key</span>)&#123;</span><br><span class="line">        <span class="variable">$location</span> = <span class="variable">$this</span>-&gt;_hash(<span class="variable">$key</span>)%<span class="variable">$this</span>-&gt;_count;</span><br><span class="line">        <span class="built_in">return</span> <span class="variable">$this</span>-&gt;_nodes[<span class="variable">$location</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">function</span> addNode(<span class="variable">$node</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(in_array(<span class="variable">$node</span>,<span class="variable">$this</span>-&gt;_nodes))&#123;</span><br><span class="line">            <span class="built_in">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$this</span>-&gt;_nodes[] =<span class="variable">$node</span>;</span><br><span class="line">        <span class="variable">$this</span>-&gt;_count+=1;</span><br><span class="line">        <span class="built_in">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">function</span> delNode(<span class="variable">$node</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(!in_array(<span class="variable">$node</span>,<span class="variable">$this</span>-&gt;_nodes))&#123;</span><br><span class="line">            <span class="built_in">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$key</span> = array_search(<span class="variable">$node</span>,<span class="variable">$this</span>-&gt;_nodes);</span><br><span class="line">        <span class="built_in">unset</span>(<span class="variable">$this</span>-&gt;_nodes[<span class="variable">$key</span>]);</span><br><span class="line">        <span class="variable">$this</span>-&gt;_nodes =array_merge(<span class="variable">$this</span>-&gt;_nodes);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$this</span>-&gt;_count-=1;</span><br><span class="line">        <span class="built_in">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Consistent implements <span class="built_in">hash</span>,distribution &#123;</span><br><span class="line"></span><br><span class="line">    protected <span class="variable">$_position</span>=[];</span><br><span class="line">    protected <span class="variable">$_nodes</span>=[];</span><br><span class="line"></span><br><span class="line">    protected <span class="variable">$_mul</span> =64;//每个节点对应64个虚节点</span><br><span class="line"></span><br><span class="line">    //对key进行转换</span><br><span class="line">    public <span class="keyword">function</span> _hash(<span class="variable">$str</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">return</span> sprintf(<span class="string">"%u"</span>,crc32(<span class="variable">$str</span>));//把字符串转成32位符号整数</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //计算key所操作的node服务器</span><br><span class="line">    public <span class="keyword">function</span> lookup(<span class="variable">$key</span>)&#123;</span><br><span class="line">        <span class="variable">$point</span> = <span class="variable">$this</span>-&gt;_hash(<span class="variable">$key</span>);</span><br><span class="line">        <span class="variable">$node</span> = current(<span class="variable">$this</span>-&gt;_position);//先取圆环上最小的一个结点，当成结果</span><br><span class="line"></span><br><span class="line">        foreach (<span class="variable">$this</span>-&gt;_position as <span class="variable">$k</span>=&gt;<span class="variable">$v</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$point</span>&lt;=<span class="variable">$k</span>)&#123;</span><br><span class="line">                <span class="variable">$node</span>=<span class="variable">$v</span>;</span><br><span class="line">                <span class="built_in">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        reset(<span class="variable">$this</span>-&gt;_position);</span><br><span class="line">        <span class="built_in">return</span> <span class="variable">$node</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    //增加服务器</span><br><span class="line">    public <span class="keyword">function</span> addNode(<span class="variable">$node</span>)&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (isset(<span class="variable">$this</span>-&gt;_nodes[<span class="variable">$node</span>]))&#123;</span><br><span class="line">            <span class="built_in">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span>=0;<span class="variable">$i</span>&lt;<span class="variable">$this</span>-&gt;_mul;<span class="variable">$i</span>++)&#123;</span><br><span class="line">            <span class="variable">$pos</span> = <span class="variable">$this</span>-&gt;_hash(<span class="variable">$node</span>.<span class="string">'-'</span>.<span class="variable">$i</span>);</span><br><span class="line">            <span class="variable">$this</span>-&gt;_position[<span class="variable">$pos</span>]=<span class="variable">$node</span>;</span><br><span class="line">            <span class="variable">$this</span>-&gt;_nodes[<span class="variable">$node</span>][]=<span class="variable">$pos</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$this</span>-&gt;_sortPos();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //对node进行排序，很重要的操作</span><br><span class="line">    public <span class="keyword">function</span> <span class="function"><span class="title">_sortPos</span></span>()&#123;</span><br><span class="line">        ksort(<span class="variable">$this</span>-&gt;_position,SORT_REGULAR);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">function</span> delNode(<span class="variable">$node</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span> (!isset(<span class="variable">$this</span>-&gt;_nodes[<span class="variable">$node</span>]))&#123;</span><br><span class="line">            <span class="built_in">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        foreach (<span class="variable">$this</span>-&gt;_nodes[<span class="variable">$node</span>] as <span class="variable">$k</span>)&#123;</span><br><span class="line">            <span class="built_in">unset</span>(<span class="variable">$this</span>-&gt;_position[<span class="variable">$k</span>]);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">unset</span>(<span class="variable">$this</span>-&gt;_nodes[<span class="variable">$node</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public <span class="keyword">function</span> <span class="function"><span class="title">getNodes</span></span>()&#123;</span><br><span class="line">        print_r(<span class="variable">$this</span>-&gt;_position);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>index.html</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE HTML&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=utf-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Highcharts Example<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdn.hcharts.cn/highcharts/highcharts.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"container"</span> <span class="attr">style</span>=<span class="string">"min-width: 310px; height: 400px; margin: 0 auto"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">    Highcharts.setOptions(&#123;</span></span><br><span class="line"><span class="undefined">        global: &#123;</span></span><br><span class="line"><span class="actionscript">            useUTC: <span class="literal">false</span></span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">    &#125;);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="actionscript">    Highcharts.chart(<span class="string">'container'</span>, &#123;</span></span><br><span class="line"><span class="undefined">        chart: &#123;</span></span><br><span class="line"><span class="actionscript">            type: <span class="string">'spline'</span>,</span></span><br><span class="line"><span class="actionscript">            animation: Highcharts.svg, <span class="comment">// don't animate in old IE</span></span></span><br><span class="line"><span class="undefined">            marginRight: 10,</span></span><br><span class="line"><span class="undefined">            events: &#123;</span></span><br><span class="line"><span class="actionscript">                load: <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="actionscript">                    <span class="comment">// set up the updating of the chart each second</span></span></span><br><span class="line"><span class="actionscript">                    <span class="keyword">var</span> series = <span class="keyword">this</span>.series[<span class="number">0</span>];</span></span><br><span class="line"><span class="actionscript">                    setInterval(<span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">                        <span class="keyword">var</span> x = (<span class="keyword">new</span> <span class="built_in">Date</span>()).getTime(), <span class="comment">// current time</span></span></span><br><span class="line"><span class="javascript">                            y = <span class="built_in">parseFloat</span>($.ajax(&#123;<span class="attr">url</span>:<span class="string">'calStats.php'</span>,<span class="attr">async</span>:<span class="literal">false</span>&#125;).responseText);</span></span><br><span class="line"><span class="actionscript">                        series.addPoint([x, y], <span class="literal">true</span>, <span class="literal">true</span>);</span></span><br><span class="line"><span class="undefined">                    &#125;, 1000);</span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">        &#125;,</span></span><br><span class="line"><span class="undefined">        title: &#123;</span></span><br><span class="line"><span class="actionscript">            text: <span class="string">'Memcached hits rate'</span></span></span><br><span class="line"><span class="undefined">        &#125;,</span></span><br><span class="line"><span class="undefined">        xAxis: &#123;</span></span><br><span class="line"><span class="actionscript">            type: <span class="string">'datetime'</span>,</span></span><br><span class="line"><span class="undefined">            tickPixelInterval: 150</span></span><br><span class="line"><span class="undefined">        &#125;,</span></span><br><span class="line"><span class="undefined">        yAxis: &#123;</span></span><br><span class="line"><span class="undefined">            title: &#123;</span></span><br><span class="line"><span class="actionscript">                text: <span class="string">'Value'</span></span></span><br><span class="line"><span class="undefined">            &#125;,</span></span><br><span class="line"><span class="undefined">            plotLines: [&#123;</span></span><br><span class="line"><span class="undefined">                value: 0,</span></span><br><span class="line"><span class="undefined">                width: 1,</span></span><br><span class="line"><span class="actionscript">                color: <span class="string">'#808080'</span></span></span><br><span class="line"><span class="undefined">            &#125;]</span></span><br><span class="line"><span class="undefined">        &#125;,</span></span><br><span class="line"><span class="undefined">        tooltip: &#123;</span></span><br><span class="line"><span class="actionscript">            formatter: <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">                <span class="keyword">return</span> <span class="string">'&lt;b&gt;'</span> + <span class="keyword">this</span>.series.name + <span class="string">'&lt;/b&gt;&lt;br/&gt;'</span> +</span></span><br><span class="line"><span class="actionscript">                    Highcharts.dateFormat(<span class="string">'%Y-%m-%d %H:%M:%S'</span>, <span class="keyword">this</span>.x) + <span class="string">'&lt;br/&gt;'</span> +</span></span><br><span class="line"><span class="actionscript">                    Highcharts.numberFormat(<span class="keyword">this</span>.y, <span class="number">2</span>);</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">        &#125;,</span></span><br><span class="line"><span class="undefined">        legend: &#123;</span></span><br><span class="line"><span class="actionscript">            enabled: <span class="literal">false</span></span></span><br><span class="line"><span class="undefined">        &#125;,</span></span><br><span class="line"><span class="undefined">        exporting: &#123;</span></span><br><span class="line"><span class="actionscript">            enabled: <span class="literal">false</span></span></span><br><span class="line"><span class="undefined">        &#125;,</span></span><br><span class="line"><span class="undefined">        series: [&#123;</span></span><br><span class="line"><span class="actionscript">            name: <span class="string">'Random data'</span>,</span></span><br><span class="line"><span class="actionscript">            data: (<span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">                <span class="comment">// generate an array of random data</span></span></span><br><span class="line"><span class="actionscript">                <span class="keyword">var</span> data = [],</span></span><br><span class="line"><span class="javascript">                    time = (<span class="keyword">new</span> <span class="built_in">Date</span>()).getTime(),</span></span><br><span class="line"><span class="undefined">                    i;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="actionscript">                <span class="keyword">for</span> (i = <span class="number">-19</span>; i &lt;= <span class="number">0</span>; i += <span class="number">1</span>) &#123;</span></span><br><span class="line"><span class="undefined">                    data.push(&#123;</span></span><br><span class="line"><span class="undefined">                        x: time + i * 1000,</span></span><br><span class="line"><span class="undefined">                        y: 1</span></span><br><span class="line"><span class="undefined">                    &#125;);</span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="actionscript">                <span class="keyword">return</span> data;</span></span><br><span class="line"><span class="undefined">            &#125;())</span></span><br><span class="line"><span class="undefined">        &#125;]</span></span><br><span class="line"><span class="undefined">    &#125;);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>InitData.php<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">/**</span><br><span class="line"> * Created by PhpStorm.</span><br><span class="line"> * User: seven</span><br><span class="line"> * Date: 2018/9/8</span><br><span class="line"> * Time: 14:13</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">//开启memcached各个端口的服务端</span><br><span class="line">//memcached.exe -m 4 -p 1121* -vvv *为端口号1-5</span><br><span class="line"></span><br><span class="line">require(<span class="string">'./config.php'</span>);</span><br><span class="line">require (<span class="string">'./Distribute.php'</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$mem</span> = new memcache();</span><br><span class="line"><span class="variable">$dis</span> = new <span class="variable">$_dis</span>();//分布式算法</span><br><span class="line"></span><br><span class="line">//循环的添加服务器</span><br><span class="line">foreach(<span class="variable">$_mem</span> as <span class="variable">$k</span>=&gt;<span class="variable">$v</span>)&#123;</span><br><span class="line">    <span class="variable">$dis</span>-&gt;addNode(<span class="variable">$k</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//初始化数据</span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$i</span>=0;<span class="variable">$i</span>&lt;1000;<span class="variable">$i</span>++)&#123;</span><br><span class="line">    <span class="variable">$i</span> = sprintf(<span class="string">'%04d'</span>,<span class="variable">$i</span>);</span><br><span class="line">    <span class="variable">$key</span> = <span class="string">'key'</span>.<span class="variable">$i</span>;</span><br><span class="line">    <span class="variable">$value</span> = <span class="string">'value'</span>.<span class="variable">$i</span>;</span><br><span class="line">    <span class="variable">$keyNode</span> = <span class="variable">$dis</span>-&gt;lookup(<span class="variable">$key</span>);</span><br><span class="line">    <span class="variable">$mem</span>-&gt;pconnect(<span class="variable">$_mem</span>[<span class="variable">$keyNode</span>][<span class="string">'host'</span>],<span class="variable">$_mem</span>[<span class="variable">$keyNode</span>][<span class="string">'port'</span>],2);</span><br><span class="line">    <span class="variable">$mem</span>-&gt;add(<span class="string">'key'</span>.<span class="variable">$i</span>,<span class="string">'value'</span>.<span class="variable">$i</span>,0,0);</span><br><span class="line">    usleep(3000);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"conplete"</span>;</span><br></pre></td></tr></table></figure></p>
<h1 id="缓存雪崩现象"><a href="#缓存雪崩现象" class="headerlink" title="缓存雪崩现象"></a>缓存雪崩现象</h1><p>该现象的产生是由某个缓存结点失效，导致其他结点的缓存命中率下降，缓存中缺失的数据去数据库查询，短时间内，造成数据库服务器崩溃</p>
<p>重启DB,短期又被压垮，缓存数据逐渐增加，DB反复多次启动多次之后，缓存才重建完毕，DB才稳定运行</p>
<p>或者是由于缓存周期性的失效，比如每6小时失效一次，每6小时将会有一个请求峰值，严重可能会令DB崩溃</p>
<h2 id="缓存雪崩解决方案"><a href="#缓存雪崩解决方案" class="headerlink" title="缓存雪崩解决方案"></a>缓存雪崩解决方案</h2><p>由于失效周期导致的雪崩的解决方案</p>
<ul>
<li>可以选择访问量小的时间段失效和更新缓存</li>
<li>设置随机3-9小时的生命周期，不同时失效，把工作分担到各个时间点上去</li>
</ul>
<h1 id="缓存的无底洞现象"><a href="#缓存的无底洞现象" class="headerlink" title="缓存的无底洞现象"></a>缓存的无底洞现象</h1><p>Facebook的工作人员反应2010年已达到3000个memcached节点，储存数千G的缓存。</p>
<p>他们发现一个问题–memcached的连接效率下降了，于是添加，memcached节点，添加完之后，并没有好转。</p>
<p>称为“无底洞”现象</p>
<h2 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h2><p>以会员信息为例：</p>
<p>‘User-133-age’  22</p>
<p>‘user-133-height’ 170</p>
<p>‘user-89-age’ 60</p>
<p>‘user-89-height’ 182</p>
<p>当服务器增多，若采取一致哈希算法来做分布式，密度变大，133号用户的信息也被散落在更多的服务器，所以，同样是访问个人主页，得到的相同的个人信息，节点越多，要连接的节点也越多，对于memcached的连接数，并没有随着节点的增多而降低，问题出现。</p>
<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>把某一组key，按其共同前缀来分布：<br>在用分布式算法求其节点时，应该以’user-133’来计算，而不是以user-133-age/name/height来计算，这样3个关于个人信息的key，都落在同一个节点，访问个人主页时，只需连接一个节点。</p>
<h1 id="永久数据被踢现象"><a href="#永久数据被踢现象" class="headerlink" title="永久数据被踢现象"></a>永久数据被踢现象</h1><p>数据设置为永久有效，却莫名其妙的丢失了</p>
<h2 id="原因-1"><a href="#原因-1" class="headerlink" title="原因"></a>原因</h2><p>由惰性删除和LRU删除算法引起的<br>可以简单理解为以下这样的过程：</p>
<ul>
<li>数据在内存中失效后，并不会立马被删除，只有在下次get时候，系统才会将其删除。</li>
<li>Memcache可以因此，被一些未被及时删除的数据占满空间。</li>
<li>加之LRU淘汰机制，永久数据如果很少被访问的话，在内存空间被占满的情况下，再有新数据被缓存，则永久数据，就有可能被删除。</li>
</ul>
<h2 id="官方解决方法："><a href="#官方解决方法：" class="headerlink" title="官方解决方法："></a>官方解决方法：</h2><p>永久数据和非永久数据分开放</p>
</div><div class="tags"></div><div class="post-nav"><a class="pre" href="/2018/09/08/Nginx基础篇/">Nginx基础篇</a><a class="next" href="/2018/08/29/使用gulp-webpack构建页面/">使用webpack构建页面</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://blog.xhzyxed.cn"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Nginx/">Nginx</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Redis/">Redis</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/docker/">docker</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/http/">http</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/javascript/">javascript</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/memcached/">memcached</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/mysql/">mysql</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/php/">php</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/vuejs/">vuejs</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/web安全/">web安全</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/前端构建工具/">前端构建工具</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/推文/">推文</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/项目/">项目</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/09/13/Linux学习之进程管理/">Linux学习之进程管理</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/13/Linux学习之服务与进程管理/">Linux学习之服务与进程管理</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/11/Linux学习之crontab定时任务/">Linux学习之crontab定时任务</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/11/Linux学习之文本编辑器/">Linux学习之文本编辑器</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/10/Nginx优化篇/">Nginx优化篇</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/09/php底层原理学习/">php底层原理学习</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/09/Linux学习之bash-shell/">Linux学习之bash_shell</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/09/Nginx应用篇/">Nginx应用篇</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/08/Nginx基础篇/">Nginx基础篇</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/07/memcached学习笔记/">memcached学习笔记</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://org.xhzyxed.cn/" title="小猴子与小耳朵" target="_blank">小猴子与小耳朵</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">其斤.匕禾页.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>