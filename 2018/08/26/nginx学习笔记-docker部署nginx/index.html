<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="努力，奋斗！"><title>Nginx学习笔记-docker部署Nginx以及常用指令上下文 | 其斤.匕禾页</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = 'https://hm.baidu.com/hm.js?' + '9a5a3ed9eb997f28f7eaa023ee5905bc';
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();</script></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Nginx学习笔记-docker部署Nginx以及常用指令上下文</h1><a id="logo" href="/.">其斤.匕禾页</a><p class="description">站在巨人的肩膀上，做只勤奋的小蜜蜂！</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/2018/10/02/lnmp技术栈文章汇总/"><i class="fa fa-archive"> LNMP技术栈</i></a><a href="/2018/10/02/速读laravel源码/"><i class="fa fa-archive"> laravel框架学习</i></a><a href="https://zhimap.com/mmap/773f7025d57f4c24b3c680bd9972c7e8"><i class="fa fa-archive"> 秒杀系统学习</i></a><a href="/2018/11/01/nosql学习汇总/"><i class="fa fa-archive"> nosql</i></a><a href="/2018/09/22/408基础/"><i class="fa fa-archive"> 计算机基础</i></a><a href="/2018/09/17/resume/"><i class="fa fa-user"> 关于</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Nginx学习笔记-docker部署Nginx以及常用指令上下文</h1><div class="post-meta">Aug 26, 2018<span> | </span><span class="category"><a href="/categories/Nginx/">Nginx</a></span></div><a class="ds-thread-count" href="/2018/08/26/nginx学习笔记-docker部署nginx/#SOHUCS"><span id="changyan_count_unit" style="font-size: 15px; color: #6E7173;">0</span><span> 条评论</span></a><script src="https://assets.changyan.sohu.com/upload/plugins/plugins.count.js" async></script><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#部署环境"><span class="toc-number">1.</span> <span class="toc-text">部署环境</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Nginx"><span class="toc-number">2.</span> <span class="toc-text">Nginx</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#什么是Nginx"><span class="toc-number">2.1.</span> <span class="toc-text">什么是Nginx</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#功能"><span class="toc-number">2.2.</span> <span class="toc-text">功能</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#涉及到知识点"><span class="toc-number">2.3.</span> <span class="toc-text">涉及到知识点</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#部署操作"><span class="toc-number">3.</span> <span class="toc-text">部署操作</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#配置文件详解"><span class="toc-number">4.</span> <span class="toc-text">配置文件详解</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#指令上下文"><span class="toc-number">4.1.</span> <span class="toc-text">指令上下文</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#server指令上下文"><span class="toc-number">5.</span> <span class="toc-text">server指令上下文</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#配置一个静态网站"><span class="toc-number">5.1.</span> <span class="toc-text">配置一个静态网站</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#配置多个网站"><span class="toc-number">5.2.</span> <span class="toc-text">配置多个网站</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#location指令上下文"><span class="toc-number">6.</span> <span class="toc-text">location指令上下文</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#举例"><span class="toc-number">6.1.</span> <span class="toc-text">举例</span></a></li></ol></li></ol></div></div><div class="post-content"><p>docker部署Nginx以及常用指令上下文</p>
<a id="more"></a>
<h1 id="部署环境"><a href="#部署环境" class="headerlink" title="部署环境"></a>部署环境</h1><ul>
<li>宿主机环境 ubuntu16</li>
<li>部署环境 docker 17.12+</li>
<li>使用的镜像 <a href="https://hub.docker.com/_/Nginx" target="_blank" rel="noopener">https://hub.docker.com/_/Nginx</a> 基于1.15-alpine</li>
</ul>
<h1 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h1><h2 id="什么是Nginx"><a href="#什么是Nginx" class="headerlink" title="什么是Nginx"></a>什么是Nginx</h2><p>Nginx (engine x) 是一款轻量级的 Web 服务器 、反向代理服务器及电子邮件（IMAP/POP3）代理服务器。</p>
<h2 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h2><ul>
<li>静态资源服务</li>
<li>反向代理</li>
<li>负载均衡</li>
<li>灰度发布</li>
</ul>
<h2 id="涉及到知识点"><a href="#涉及到知识点" class="headerlink" title="涉及到知识点"></a>涉及到知识点</h2><ul>
<li>Nginx的配置，指令，内置变量学习</li>
<li>部署案例</li>
<li>openresty的初步使用</li>
<li>基于lua嵌入式开发</li>
</ul>
<h1 id="部署操作"><a href="#部署操作" class="headerlink" title="部署操作"></a>部署操作</h1><ul>
<li><p>docker拉取Nginx镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull Nginx:1.15-alpine</span><br></pre></td></tr></table></figure>
</li>
<li><p>运行容器</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker run --name Nginx-test1 -d -p 9090:80 \</span><br><span class="line">Nginx:1.15-alpine</span><br><span class="line">或者</span><br><span class="line">docekr run --name Nginx-test -p 9090:8090 -v /root/myNginx/html:/tmp/html -v /root/myNginx/Nginx.conf:/etc/Nginx/Nginx.conf</span><br></pre></td></tr></table></figure>
<ul>
<li>进入到容器</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">    docker <span class="built_in">exec</span> -it Nginx-test sh</span><br><span class="line">```   </span><br><span class="line">- 在宿主机中拷贝docker中的Nginx配置文件</span><br><span class="line"></span><br><span class="line">    ctrl+d 退出docker sh</span><br><span class="line">    mkdir myNginx</span><br><span class="line">    docker cp Nginx-test:/etc/Nginx/Nginx.conf myNginx</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- 停止删除容器</span><br><span class="line">``` bash</span><br><span class="line"></span><br><span class="line">    docker stop Nginx-test &amp;&amp; docker rm Nginx-test</span><br></pre></td></tr></table></figure>
<h1 id="配置文件详解"><a href="#配置文件详解" class="headerlink" title="配置文件详解"></a>配置文件详解</h1><p>具体详解可以看<a href="http://tengine.taobao.org/book/chapter_02.html#id6" target="_blank" rel="noopener">Nginx开发从入门到精通</a>的这一章Nginx文件配置</p>
<h2 id="指令上下文"><a href="#指令上下文" class="headerlink" title="指令上下文"></a>指令上下文</h2><blockquote>
<p>Nginx.conf中的配置信息，根据其逻辑上的意义，对它们进行了分类，也就是分成了多个作用域，或者称之为配置指令上下文。不同的作用域含有一个或者多个配置项。<br> 当前Nginx支持的几个指令上下文：</p>
</blockquote>
<ul>
<li>main:    Nginx在运行时与具体业务功能（比如http服务或者email服务代理）无关的一些参数，比如工作进程数，运行的身份等。</li>
<li>http:    与提供http服务相关的一些配置参数。例如：是否使用keepalive啊，是否使用gzip进行压缩等。</li>
<li>server:    http服务上支持若干虚拟主机。每个虚拟主机一个对应的server配置项，配置项里面包含该虚拟主机相关的配置。在提供mail服务的代理时，也可以建立若干server.每个server通过监听的地址来区分。</li>
<li>location:    http服务中，某些特定的URL对应的一系列配置项。</li>
<li><p>mail:    实现email相关的SMTP/IMAP/POP3代理时，共享的一些配置项（因为可能实现多个代理，工作在多个监听地址上）。</p>
<p>指令上下文，可能有包含的情况出现。例如：通常http上下文和mail上下文一定是出现在main上下文里的。在一个上下文里，可能包含另外一种类型的上下文多次。例如：如果http服务，支持了多个虚拟主机，那么在http上下文里，就会出现多个server上下文。</p>
</li>
</ul>
<p>因此，我们很简单的通过server指令来配置多个网站</p>
<h1 id="server指令上下文"><a href="#server指令上下文" class="headerlink" title="server指令上下文"></a>server指令上下文</h1><p>server需要存在于http上下文指令中</p>
<h2 id="配置一个静态网站"><a href="#配置一个静态网站" class="headerlink" title="配置一个静态网站"></a>配置一个静态网站</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">http&#123;   <span class="comment">#用来处理http协议相关</span></span><br><span class="line"></span><br><span class="line">  server&#123;</span><br><span class="line">      listen 80;</span><br><span class="line">      server_name localhost;</span><br><span class="line">      location /&#123;</span><br><span class="line">          root /var/www/html; <span class="comment">#网站目录</span></span><br><span class="line">          index index.html;   <span class="comment">#默认首页</span></span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="配置多个网站"><a href="#配置多个网站" class="headerlink" title="配置多个网站"></a>配置多个网站</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">http&#123;   <span class="comment">#用来处理http协议相关</span></span><br><span class="line">   </span><br><span class="line">     server &#123;</span><br><span class="line">           listen          80;</span><br><span class="line">           server_name     www.linuxidc.com;</span><br><span class="line">           access_log      logs/linuxidc.access.log main;</span><br><span class="line">           location / &#123;</span><br><span class="line">               index index.html;</span><br><span class="line">               root  /var/www/linuxidc.com/htdocs;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">   </span><br><span class="line">       server &#123;</span><br><span class="line">           listen          80;</span><br><span class="line">           server_name     www.Androidj.com;</span><br><span class="line">           access_log      logs/androidj.access.log main;</span><br><span class="line">           location / &#123;</span><br><span class="line">               index index.html;</span><br><span class="line">               root  /var/www/androidj.com/htdocs;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">     </span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h1 id="location指令上下文"><a href="#location指令上下文" class="headerlink" title="location指令上下文"></a>location指令上下文</h1><p>存在于location上下文中的指令如下：</p>
<ul>
<li>index</li>
<li>root</li>
</ul>
<p>基本形式：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">location [=!~!~*!^~!/] 你的URL&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>=精确匹配； </li>
<li>~区分大小写的正则匹配； </li>
<li>^~同上。^在正则里表示已某字符串开头; </li>
<li>~*不区分大小写的正则匹配; </li>
<li>!~和!~* !为取反，不匹配； </li>
<li>/通用匹配，任何请求都会匹配到; </li>
<li>@内部跳转用，外部不能访问 </li>
</ul>
<h2 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">    location ^~ /about/&#123;</span><br><span class="line">        root /var/www/abc;</span><br><span class="line">        index help.html;</span><br><span class="line">    &#125;</span><br><span class="line">```    </span><br><span class="line">这里是以/about/开头的请求，都会匹配上。</span><br><span class="line">``` bash</span><br><span class="line"></span><br><span class="line">    http://abc.com/about/   这个ok</span><br><span class="line">    http://abc.com/about/abc.html  这也ok，只要你abc.html存在</span><br><span class="line"> ```   </span><br><span class="line"><span class="comment">## 静态资源访问</span></span><br><span class="line"></span><br><span class="line">常用的配置</span><br><span class="line">``` bash</span><br><span class="line"></span><br><span class="line">    locaction ~* \.(gif|jpg|jpeg|png|js|css)$&#123;</span><br><span class="line">        root /var/www/abc/assets</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></div><div class="tags"></div><div class="post-nav"><a class="pre" href="/2018/08/26/nginx学习笔记-反向代理/">Nginx学习笔记-反向代理</a><a class="next" href="/2018/08/23/Redis-cluster集群/">Redis-cluster集群</a></div><div id="SOHUCS" sid="1535291026000"></div><script>(function(){var appid='cytTB77q5';var conf='';var width=window.innerWidth||document.documentElement.clientWidth;if(width<960){window.document.write('<script id="changyan_mobile_js" charset="utf-8" type="text/javascript" src="https://changyan.sohu.com/upload/mobile/wap-js/changyan_mobile.js?client_id='+appid+'&conf='+conf+'"><\/script>')}else{var loadJs=function(d,a){var c=document.getElementsByTagName("head")[0]||document.head||document.documentElement;var b=document.createElement("script");b.setAttribute("type","text/javascript");b.setAttribute("charset","UTF-8");b.setAttribute("src",d);if(typeof a==="function"){if(window.attachEvent){b.onreadystatechange=function(){var e=b.readyState;if(e==="loaded"||e==="complete"){b.onreadystatechange=null;a()}}}else{b.onload=a}}c.appendChild(b)};loadJs("https://changyan.sohu.com/upload/changyan.js",function(){window.changyan.api.config({appid:appid,conf:conf})})}})()
</script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/408/">408</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Nginx/">Nginx</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Redis/">Redis</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/docker/">docker</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/http/">http</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/javascript/">javascript</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/memcached/">memcached</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/mysql/">mysql</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/php/">php</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/vuejs/">vuejs</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/web安全/">web安全</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/前端构建工具/">前端构建工具</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/推文/">推文</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/项目/">项目</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/11/02/composer的理想/">composer的理想</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/01/nosql学习汇总/">nosql学习汇总</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/31/deployer的使用报告/">deployer的使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/20/laravel学习之Response/">laravel学习之Response</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/20/laravel学习之Request/">laravel学习之Request</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/17/laravel学习之路由/">laravel学习之路由</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/14/laravel学习之中间件/">laravel学习之中间件</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/11/laravel学习之Facades/">laravel学习之Facades</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/10/laravel学习之服务提供者/">laravel学习之服务提供者</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/09/laravel学习之服务容器/">laravel学习之服务容器</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://org.xhzyxed.cn/" title="小猴子与小耳朵" target="_blank">小猴子与小耳朵</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">其斤.匕禾页.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>