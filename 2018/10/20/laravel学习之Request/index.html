<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="努力，奋斗！"><title>laravel学习之Request | 其斤.匕禾页</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = 'https://hm.baidu.com/hm.js?' + '9a5a3ed9eb997f28f7eaa023ee5905bc';
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();</script></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">laravel学习之Request</h1><a id="logo" href="/.">其斤.匕禾页</a><p class="description">站在巨人的肩膀上，做只勤奋的小蜜蜂！</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/2018/10/02/lnmp技术栈文章汇总/"><i class="fa fa-archive"> LNMP技术栈</i></a><a href="/2018/10/02/速读laravel源码/"><i class="fa fa-archive"> laravel框架学习</i></a><a href="https://zhimap.com/mmap/773f7025d57f4c24b3c680bd9972c7e8"><i class="fa fa-archive"> 秒杀系统学习</i></a><a href="/2018/11/01/nosql学习汇总/"><i class="fa fa-archive"> nosql</i></a><a href="/2018/09/22/408基础/"><i class="fa fa-archive"> 计算机基础</i></a><a href="/2018/09/17/resume/"><i class="fa fa-user"> 关于</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">laravel学习之Request</h1><div class="post-meta">Oct 20, 2018<span> | </span><span class="category"><a href="/categories/php/">php</a></span></div><a class="ds-thread-count" href="/2018/10/20/laravel学习之Request/#SOHUCS"><span id="changyan_count_unit" style="font-size: 15px; color: #6E7173;">0</span><span> 条评论</span></a><script src="https://assets.changyan.sohu.com/upload/plugins/plugins.count.js" async></script><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Request"><span class="toc-number">1.</span> <span class="toc-text">Request</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#创建Request对象"><span class="toc-number">1.1.</span> <span class="toc-text">创建Request对象</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#总结"><span class="toc-number">1.1.1.</span> <span class="toc-text">总结</span></a></li></ol></li></ol></li></ol></div></div><div class="post-content"><p>当我们定义好路由之后就可以编写控制器来处理请求了，路由的知识上一篇已经基本过了一遍，接下来我们来看Request</p>
<a id="more"></a>
<h1 id="Request"><a href="#Request" class="headerlink" title="Request"></a>Request</h1><p>laravel中的request构建在<code>Symfony</code>框架提供的Request组件基础之上的。虽说速查手册有说明request的各种方法，但是如果我们看了源码，我们就直接在源码中寻找request的方法就好了，比如路径在vendor/laravel/Illuminate/Http/Request.php中，</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">namespace Illuminate\Http;</span><br><span class="line"></span><br><span class="line">use Closure;</span><br><span class="line">use ArrayAccess;</span><br><span class="line">use RuntimeException;</span><br><span class="line">use Illuminate\Support\Arr;</span><br><span class="line">use Illuminate\Support\Str;</span><br><span class="line">use Illuminate\Support\Traits\Macroable;</span><br><span class="line">use Illuminate\Contracts\Support\Arrayable;</span><br><span class="line">use Symfony\Component\HttpFoundation\ParameterBag;</span><br><span class="line">use Symfony\Component\HttpFoundation\Request as SymfonyRequest;</span><br><span class="line"></span><br><span class="line">class Request extends SymfonyRequest implements Arrayable, ArrayAccess</span><br><span class="line">&#123;</span><br><span class="line">    use Concerns\InteractsWithContentTypes,</span><br><span class="line">        Concerns\InteractsWithFlashData,</span><br><span class="line">        Concerns\InteractsWithInput,</span><br><span class="line">        Macroable;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * The decoded JSON content <span class="keyword">for</span> the request.</span><br><span class="line">     *</span><br><span class="line">     * @var \Symfony\Component\HttpFoundation\ParameterBag|null</span><br><span class="line">     */</span><br><span class="line">    protected <span class="variable">$json</span>;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * All of the converted files <span class="keyword">for</span> the request.</span><br><span class="line">     *</span><br><span class="line">     * @var array</span><br><span class="line">     */</span><br><span class="line">    protected <span class="variable">$convertedFiles</span>;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * The user resolver callback.</span><br><span class="line">     *</span><br><span class="line">     * @var \Closure</span><br><span class="line">     */</span><br><span class="line">    protected <span class="variable">$userResolver</span>;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * The route resolver callback.</span><br><span class="line">     *</span><br><span class="line">     * @var \Closure</span><br><span class="line">     */</span><br><span class="line">    protected <span class="variable">$routeResolver</span>;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Create a new Illuminate HTTP request from server variables.</span><br><span class="line">     *</span><br><span class="line">     * @<span class="built_in">return</span> static</span><br><span class="line">     */</span><br><span class="line">    public static <span class="keyword">function</span> capture()</span><br><span class="line">    &#123;</span><br><span class="line">        static::enableHttpMethodParameterOverride();</span><br><span class="line"></span><br><span class="line">        <span class="built_in">return</span> static::createFromBase(SymfonyRequest::createFromGlobals());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Return the Request instance.</span><br><span class="line">     *</span><br><span class="line">     * @<span class="built_in">return</span> <span class="variable">$this</span></span><br><span class="line">     */</span><br><span class="line">    public <span class="keyword">function</span> instance()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">return</span> <span class="variable">$this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Get the request method.</span><br><span class="line">     *</span><br><span class="line">     * @<span class="built_in">return</span> string</span><br><span class="line">     */</span><br><span class="line">    public <span class="keyword">function</span> method()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">return</span> <span class="variable">$this</span>-&gt;getMethod();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Get the root URL <span class="keyword">for</span> the application.</span><br><span class="line">     *</span><br><span class="line">     * @<span class="built_in">return</span> string</span><br><span class="line">     */</span><br><span class="line">    public <span class="keyword">function</span> root()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">return</span> rtrim(<span class="variable">$this</span>-&gt;getSchemeAndHttpHost().<span class="variable">$this</span>-&gt;getBaseUrl(), <span class="string">'/'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">    /**</span><br><span class="line">     * Check <span class="keyword">if</span> an input element is <span class="built_in">set</span> on the request.</span><br><span class="line">     *</span><br><span class="line">     * @param  string  <span class="variable">$key</span></span><br><span class="line">     * @<span class="built_in">return</span> bool</span><br><span class="line">     */</span><br><span class="line">    public <span class="keyword">function</span> __isset(<span class="variable">$key</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">return</span> ! is_null(<span class="variable">$this</span>-&gt;__get(<span class="variable">$key</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Get an input element from the request.</span><br><span class="line">     *</span><br><span class="line">     * @param  string  <span class="variable">$key</span></span><br><span class="line">     * @<span class="built_in">return</span> mixed</span><br><span class="line">     */</span><br><span class="line">    public <span class="keyword">function</span> __get(<span class="variable">$key</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (array_key_exists(<span class="variable">$key</span>, <span class="variable">$this</span>-&gt;all())) &#123;</span><br><span class="line">            <span class="built_in">return</span> data_get(<span class="variable">$this</span>-&gt;all(), <span class="variable">$key</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">return</span> <span class="variable">$this</span>-&gt;route(<span class="variable">$key</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里只列出一些，具体可以去源码查看，接下来我们来看laravel是怎么创建的</p>
<h2 id="创建Request对象"><a href="#创建Request对象" class="headerlink" title="创建Request对象"></a>创建Request对象</h2><p>我们可以在Laravel应用程序的<code>index.php</code>文件中看到，在Laravel应用程序正式启动完成前Request对象就已经被创建好了：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//public/index.php</span></span><br><span class="line">$app = <span class="keyword">require_once</span> <span class="keyword">__DIR__</span>.<span class="string">'/../bootstrap/app.php'</span>;</span><br><span class="line"></span><br><span class="line">$kernel = $app-&gt;make(Illuminate\Contracts\Http\Kernel::class);</span><br><span class="line"></span><br><span class="line">$response = $kernel-&gt;handle(</span><br><span class="line">    <span class="comment">//创建request对象</span></span><br><span class="line">    $request = Illuminate\Http\Request::capture()</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>客户端的HTTP请求是<code>Illuminate\Http\Request</code>类的对象</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Request</span> <span class="keyword">extends</span> <span class="title">SymfonyRequest</span> <span class="keyword">implements</span> <span class="title">Arrayable</span>, <span class="title">ArrayAccess</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="comment">//新建Request实例</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">capture</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">static</span>::enableHttpMethodParameterOverride();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">static</span>::createFromBase(SymfonyRequest::createFromGlobals());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过<code>Illuminate\Http\Request</code>类的源码可以看到它是继承自<code>Symfony Request</code>类的，所以<code>Illuminate\Http\Request</code>类中实现的很多功能都是以<code>Symfony Reques</code>提供的功能为基础来实现的。上面的代码就可以看到<code>capture</code>方法新建Request对象时也是依赖于<code>Symfony Request</code>类的实例的。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">HttpFoundation</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Request</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据PHP提供的超级全局数组来创建Smyfony Request实例</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> static</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">createFromGlobals</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// With the php's bug #66606, the php's built-in web server</span></span><br><span class="line">        <span class="comment">// stores the Content-Type and Content-Length header values in</span></span><br><span class="line">        <span class="comment">// HTTP_CONTENT_TYPE and HTTP_CONTENT_LENGTH fields.</span></span><br><span class="line">        $server = $_SERVER;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">'cli-server'</span> === PHP_SAPI) &#123;</span><br><span class="line">            <span class="keyword">if</span> (array_key_exists(<span class="string">'HTTP_CONTENT_LENGTH'</span>, $_SERVER)) &#123;</span><br><span class="line">                $server[<span class="string">'CONTENT_LENGTH'</span>] = $_SERVER[<span class="string">'HTTP_CONTENT_LENGTH'</span>];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (array_key_exists(<span class="string">'HTTP_CONTENT_TYPE'</span>, $_SERVER)) &#123;</span><br><span class="line">                $server[<span class="string">'CONTENT_TYPE'</span>] = $_SERVER[<span class="string">'HTTP_CONTENT_TYPE'</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $request = <span class="keyword">self</span>::createRequestFromFactory($_GET, $_POST, <span class="keyword">array</span>(), $_COOKIE, $_FILES, $server);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="number">0</span> === strpos($request-&gt;headers-&gt;get(<span class="string">'CONTENT_TYPE'</span>), <span class="string">'application/x-www-form-urlencoded'</span>)</span><br><span class="line">            &amp;&amp; in_array(strtoupper($request-&gt;server-&gt;get(<span class="string">'REQUEST_METHOD'</span>, <span class="string">'GET'</span>)), <span class="keyword">array</span>(<span class="string">'PUT'</span>, <span class="string">'DELETE'</span>, <span class="string">'PATCH'</span>))</span><br><span class="line">        ) &#123;</span><br><span class="line">            parse_str($request-&gt;getContent(), $data);</span><br><span class="line">            $request-&gt;request = <span class="keyword">new</span> ParameterBag($data);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> $request;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面的代码有一处需要额外解释一下，自PHP5.4开始PHP内建的builtin web server可以通过命令行解释器来启动，例如：</p>
<blockquote>
<p>php -S localhost:8000 -t htdocs</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> -S &lt;addr&gt;:&lt;port&gt; Run with built-in web server.</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> -t &lt;docroot&gt;     Specify document root &lt;docroot&gt; <span class="keyword">for</span> built-in web server.</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"></span></span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
</blockquote>
<p>但是内建web server有一个bug是将<code>CONTENT_LENGTH</code>和<code>CONTENT_TYPE</code>这两个请求首部存储到了<code>HTTP_CONTENT_LENGTH</code>和<code>HTTP_CONTENT_TYPE</code>中，为了统一内建服务器和真正的server中的请求首部字段所以在这里做了特殊处理。</p>
<p>Symfony Request 实例的创建是通过PHP中的超级全局数组来创建的，这些超级全局数组有<code>$_GET</code>，<code>$_POST</code>，<code>$_COOKIE</code>，<code>$_FILES</code>，<code>$_SERVER</code>涵盖了PHP中所有与HTTP请求相关的超级全局数组，创建Symfony Request实例时会根据这些全局数组创建Symfony Package里提供的<code>ParamterBag</code> <code>ServerBag</code> <code>FileBag</code> <code>HeaderBag</code>实例，这些Bag都是Symfony提供地针对不同HTTP组成部分的访问和设置API， 关于Symfony提供的<code>ParamterBag</code>这些实例有兴趣的读者自己去源码里看看吧，这里就不多说了。</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">class Request</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * @param<span class="built_in"> array </span>               $query      The GET parameters</span><br><span class="line">     * @param<span class="built_in"> array </span>               $request    The POST parameters</span><br><span class="line">     * @param<span class="built_in"> array </span>               $attributes The request attributes (parameters parsed from the PATH_INFO, ...)</span><br><span class="line">     * @param<span class="built_in"> array </span>               $cookies    The COOKIE parameters</span><br><span class="line">     * @param<span class="built_in"> array </span>               $files      The FILES parameters</span><br><span class="line">     * @param<span class="built_in"> array </span>               $server     The SERVER parameters</span><br><span class="line">     * @param string|resource|null $content    The raw body data</span><br><span class="line">     */</span><br><span class="line">   <span class="keyword"> public</span> function __construct(array $query = array(),<span class="built_in"> array </span>$request = array(),<span class="built_in"> array </span>$attributes = array(),<span class="built_in"> array </span>$cookies = array(),<span class="built_in"> array </span>$files = array(),<span class="built_in"> array </span>$server = array(), $content = null)</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;initialize($query, $request, $attributes, $cookies, $files, $server, $content);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">   <span class="keyword"> public</span> function initialize(array $query = array(),<span class="built_in"> array </span>$request = array(),<span class="built_in"> array </span>$attributes = array(),<span class="built_in"> array </span>$cookies = array(),<span class="built_in"> array </span>$files = array(),<span class="built_in"> array </span>$server = array(), $content = null)</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;request =<span class="built_in"> new </span>ParameterBag($request);</span><br><span class="line">        $this-&gt;query =<span class="built_in"> new </span>ParameterBag($query);</span><br><span class="line">        $this-&gt;attributes =<span class="built_in"> new </span>ParameterBag($attributes);</span><br><span class="line">        $this-&gt;cookies =<span class="built_in"> new </span>ParameterBag($cookies);</span><br><span class="line">        $this-&gt;files =<span class="built_in"> new </span>FileBag($files);</span><br><span class="line">        $this-&gt;server =<span class="built_in"> new </span>ServerBag($server);</span><br><span class="line">        $this-&gt;headers =<span class="built_in"> new </span>HeaderBag($this-&gt;server-&gt;getHeaders());</span><br><span class="line"></span><br><span class="line">        $this-&gt;content = $content;</span><br><span class="line">        $this-&gt;languages = null;</span><br><span class="line">        $this-&gt;charsets = null;</span><br><span class="line">        $this-&gt;encodings = null;</span><br><span class="line">        $this-&gt;acceptableContentTypes = null;</span><br><span class="line">        $this-&gt;pathInfo = null;</span><br><span class="line">        $this-&gt;requestUri = null;</span><br><span class="line">        $this-&gt;baseUrl = null;</span><br><span class="line">        $this-&gt;basePath = null;</span><br><span class="line">        $this-&gt;method = null;</span><br><span class="line">        $this-&gt;format = null;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到Symfony Request类除了上边说到的那几个，还有很多属性，这些属性在一起构成了对HTTP请求完整的抽象，我们可以通过实例属性方便地访问<code>Method</code>，<code>Charset</code>等这些HTTP请求的属性。</p>
<p>拿到Symfony Request实例后， Laravel会克隆这个实例并重设其中的一些属性：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">Illuminate</span>\<span class="title">Http</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Request</span> <span class="keyword">extends</span> ....</span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">//在Symfony request instance的基础上创建Request实例</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">createFromBase</span><span class="params">(SymfonyRequest $request)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> ($request <span class="keyword">instanceof</span> <span class="keyword">static</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> $request;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $content = $request-&gt;content;</span><br><span class="line"></span><br><span class="line">        $request = (<span class="keyword">new</span> <span class="keyword">static</span>)-&gt;duplicate(</span><br><span class="line">            $request-&gt;query-&gt;all(), $request-&gt;request-&gt;all(), $request-&gt;attributes-&gt;all(),</span><br><span class="line">            $request-&gt;cookies-&gt;all(), $request-&gt;files-&gt;all(), $request-&gt;server-&gt;all()</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        $request-&gt;content = $content;</span><br><span class="line"></span><br><span class="line">        $request-&gt;request = $request-&gt;getInputSource();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> $request;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">duplicate</span><span class="params">(array $query = null, array $request = null, array $attributes = null, array $cookies = null, array $files = null, array $server = null)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">parent</span>::duplicate($query, $request, $attributes, $cookies, <span class="keyword">$this</span>-&gt;filterFiles($files), $server);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">	<span class="comment">//Symfony Request中的 duplicate方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">duplicate</span><span class="params">(array $query = null, array $request = null, array $attributes = null, array $cookies = null, array $files = null, array $server = null)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $dup = <span class="keyword">clone</span> <span class="keyword">$this</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> !== $query) &#123;</span><br><span class="line">            $dup-&gt;query = <span class="keyword">new</span> ParameterBag($query);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> !== $request) &#123;</span><br><span class="line">            $dup-&gt;request = <span class="keyword">new</span> ParameterBag($request);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> !== $attributes) &#123;</span><br><span class="line">            $dup-&gt;attributes = <span class="keyword">new</span> ParameterBag($attributes);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> !== $cookies) &#123;</span><br><span class="line">            $dup-&gt;cookies = <span class="keyword">new</span> ParameterBag($cookies);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> !== $files) &#123;</span><br><span class="line">            $dup-&gt;files = <span class="keyword">new</span> FileBag($files);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> !== $server) &#123;</span><br><span class="line">            $dup-&gt;server = <span class="keyword">new</span> ServerBag($server);</span><br><span class="line">            $dup-&gt;headers = <span class="keyword">new</span> HeaderBag($dup-&gt;server-&gt;getHeaders());</span><br><span class="line">        &#125;</span><br><span class="line">        $dup-&gt;languages = <span class="keyword">null</span>;</span><br><span class="line">        $dup-&gt;charsets = <span class="keyword">null</span>;</span><br><span class="line">        $dup-&gt;encodings = <span class="keyword">null</span>;</span><br><span class="line">        $dup-&gt;acceptableContentTypes = <span class="keyword">null</span>;</span><br><span class="line">        $dup-&gt;pathInfo = <span class="keyword">null</span>;</span><br><span class="line">        $dup-&gt;requestUri = <span class="keyword">null</span>;</span><br><span class="line">        $dup-&gt;baseUrl = <span class="keyword">null</span>;</span><br><span class="line">        $dup-&gt;basePath = <span class="keyword">null</span>;</span><br><span class="line">        $dup-&gt;method = <span class="keyword">null</span>;</span><br><span class="line">        $dup-&gt;format = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!$dup-&gt;get(<span class="string">'_format'</span>) &amp;&amp; <span class="keyword">$this</span>-&gt;get(<span class="string">'_format'</span>)) &#123;</span><br><span class="line">            $dup-&gt;attributes-&gt;set(<span class="string">'_format'</span>, <span class="keyword">$this</span>-&gt;get(<span class="string">'_format'</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!$dup-&gt;getRequestFormat(<span class="keyword">null</span>)) &#123;</span><br><span class="line">            $dup-&gt;setRequestFormat(<span class="keyword">$this</span>-&gt;getRequestFormat(<span class="keyword">null</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> $dup;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>创建完Request对象后， Laravel的Http Kernel会接着往下执行：加载服务提供器引导Laravel应用、启动应用、让Request经过基础的中间件、通过Router匹配查找Request对应的路由、执行匹配到的路由、Request经过路由上到中间件到达控制器方法。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>随着Request最终到达对应的控制器方法后它的使命基本上也就完成了， 在控制器方法里从Request中获取输入参数然后执行应用的某一业务逻辑获得结果，结果会被转化成Response响应对象返回给发起请求的客户端。</p>
</div><div class="tags"></div><div class="post-nav"><a class="pre" href="/2018/10/20/laravel学习之Response/">laravel学习之Response</a><a class="next" href="/2018/10/17/laravel学习之路由/">laravel学习之路由</a></div><div id="SOHUCS" sid="1540045014000"></div><script>(function(){var appid='cytTB77q5';var conf='';var width=window.innerWidth||document.documentElement.clientWidth;if(width<960){window.document.write('<script id="changyan_mobile_js" charset="utf-8" type="text/javascript" src="https://changyan.sohu.com/upload/mobile/wap-js/changyan_mobile.js?client_id='+appid+'&conf='+conf+'"><\/script>')}else{var loadJs=function(d,a){var c=document.getElementsByTagName("head")[0]||document.head||document.documentElement;var b=document.createElement("script");b.setAttribute("type","text/javascript");b.setAttribute("charset","UTF-8");b.setAttribute("src",d);if(typeof a==="function"){if(window.attachEvent){b.onreadystatechange=function(){var e=b.readyState;if(e==="loaded"||e==="complete"){b.onreadystatechange=null;a()}}}else{b.onload=a}}c.appendChild(b)};loadJs("https://changyan.sohu.com/upload/changyan.js",function(){window.changyan.api.config({appid:appid,conf:conf})})}})()
</script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/408/">408</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Nginx/">Nginx</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Redis/">Redis</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/docker/">docker</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/http/">http</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/javascript/">javascript</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/memcached/">memcached</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/mysql/">mysql</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/php/">php</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/vuejs/">vuejs</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/web安全/">web安全</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/前端构建工具/">前端构建工具</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/推文/">推文</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/项目/">项目</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/11/02/composer的理想/">composer的理想</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/01/nosql学习汇总/">nosql学习汇总</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/31/deployer的使用报告/">deployer的使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/20/laravel学习之Response/">laravel学习之Response</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/20/laravel学习之Request/">laravel学习之Request</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/17/laravel学习之路由/">laravel学习之路由</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/14/laravel学习之中间件/">laravel学习之中间件</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/11/laravel学习之Facades/">laravel学习之Facades</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/10/laravel学习之服务提供者/">laravel学习之服务提供者</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/09/laravel学习之服务容器/">laravel学习之服务容器</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://org.xhzyxed.cn/" title="小猴子与小耳朵" target="_blank">小猴子与小耳朵</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">其斤.匕禾页.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>