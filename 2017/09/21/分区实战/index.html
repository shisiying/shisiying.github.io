<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="努力，奋斗！"><title>全文索引与分区学习笔记 | 其斤.匕禾页</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">全文索引与分区学习笔记</h1><a id="logo" href="/.">其斤.匕禾页</a><p class="description">永远相信美好的事情即将发生</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="https://blog.xhzyxed.cn/2018/09/22/408基础/"><i class="fa fa-archive"> 计算机基础</i></a><a href="https://blog.xhzyxed.cn/2018/09/17/resume/"><i class="fa fa-user"> resume</i></a><a href="https://www.xhzyxed.cn/"><i class="fa fa-user"> 关于</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">全文索引与分区学习笔记</h1><div class="post-meta">Sep 21, 2017<span> | </span><span class="category"><a href="/categories/mysql/">mysql</a></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#全文索引"><span class="toc-number">1.</span> <span class="toc-text">全文索引</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#创建文章表"><span class="toc-number">1.1.</span> <span class="toc-text">创建文章表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#创建索引"><span class="toc-number">1.2.</span> <span class="toc-text">创建索引</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用全文索引查询"><span class="toc-number">1.3.</span> <span class="toc-text">使用全文索引查询</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#分区"><span class="toc-number">2.</span> <span class="toc-text">分区</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#什么是分区"><span class="toc-number">2.1.</span> <span class="toc-text">什么是分区</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#为什么要分区"><span class="toc-number">2.2.</span> <span class="toc-text">为什么要分区</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#分区的好处或者分区能解决什么问题"><span class="toc-number">2.2.1.</span> <span class="toc-text">分区的好处或者分区能解决什么问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#要分区的情况"><span class="toc-number">2.3.</span> <span class="toc-text">要分区的情况</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#分区实战"><span class="toc-number">2.4.</span> <span class="toc-text">分区实战</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#存储过程插入800万数据"><span class="toc-number">2.5.</span> <span class="toc-text">存储过程插入800万数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#测试分表与不分区的性能"><span class="toc-number">2.6.</span> <span class="toc-text">测试分表与不分区的性能</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#手工插入一些数据"><span class="toc-number">2.6.1.</span> <span class="toc-text">手工插入一些数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#分区-1"><span class="toc-number">2.6.2.</span> <span class="toc-text">分区</span></a></li></ol></li></ol></li></ol></div></div><div class="post-content"><p>在数据量到达一定程度的时候，我们会发现，查询数据会变得越来越慢，这时候，我们需要对数据表进行优化，而且，提前优化设计表是大忌<br>接下来我们介绍全文索引和表的分区<br><a id="more"></a></p>
<h1 id="全文索引"><a href="#全文索引" class="headerlink" title="全文索引"></a>全文索引</h1><blockquote>
<p>全文索引（也称全文检索）是目前搜索引擎使用的一种关键技术。它能够利用【分词技术】等多种算法智能分析出文本文字中关键词的频率和重要性，然后按照一定的算法规则智能地筛选出我们想要的搜索结果。</p>
</blockquote>
<p>其实需要建立全文索引，与很多优秀的第三方可以使用，因为MySql自带的全文索引只能用于数据库引擎为MYISAM的数据表，如果是其他数据引擎，则全文索引不会生效。此外，MySql自带的全文索引只能对英文进行全文检索，目前无法对中文进行全文检索。如果需要对包含中文在内的文本数据进行全文检索，我们需要采用Sphinx（斯芬克斯）/Coreseek技术来处理中文。</p>
<h2 id="创建文章表"><a href="#创建文章表" class="headerlink" title="创建文章表"></a>创建文章表</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `article` (</span><br><span class="line"></span><br><span class="line">  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,</span><br><span class="line"></span><br><span class="line">  `title` varchar(200) DEFAULT NULL,</span><br><span class="line"></span><br><span class="line">  `content` text,</span><br><span class="line"></span><br><span class="line">  PRIMARY KEY (`id`),</span><br><span class="line"></span><br><span class="line">  FULLTEXT KEY `title` (`title`,`content`)</span><br><span class="line"></span><br><span class="line">) ENGINE=MyISAM DEFAULT CHARSET=utf8;</span><br></pre></td></tr></table></figure>
<h2 id="创建索引"><a href="#创建索引" class="headerlink" title="创建索引"></a>创建索引</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">ALTER TABLE article ADD FULLTEXT INDEX fulltext_article(title,content);</span><br></pre></td></tr></table></figure>
<h2 id="使用全文索引查询"><a href="#使用全文索引查询" class="headerlink" title="使用全文索引查询"></a>使用全文索引查询</h2><p>以前，如果没有建立全文索引的时候，如果要模糊匹配含有某个关键词的文章，我们都会使用like<br>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">  </span><br><span class="line">SELECT * FROM article WHERE content LIKE ‘%查询字符串%’;</span><br></pre></td></tr></table></figure></p>
<p>现在已经创建了全文索引，我们可以编写如下语句：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">SELECT * FROM article WHERE MATCH(title,content) AGAINST (‘查询字符串’);</span><br></pre></td></tr></table></figure></p>
<h1 id="分区"><a href="#分区" class="headerlink" title="分区"></a>分区</h1><h2 id="什么是分区"><a href="#什么是分区" class="headerlink" title="什么是分区"></a>什么是分区</h2><p>分区是将数据分段在多个位置存放，可以是同一个磁盘也可以在不同的机器。分区后，表面上还是一张表，但数据分散到多个位置了。应用读写的时候操作的还是大表名字，db自动去组织分区的数据。</p>
<p>##分区的类型</p>
<p>MySQL支持RANGE，LIST，HASH，KEY分区类型，其中以RANGE最为常用：</p>
<p>Range（范围）–这种模式允许将数据划分不同范围。例如可以将一个表通过年份划分成若干个分区。<br>Hash（哈希）–这中模式允许通过对表的一个或多个列的Hash Key进行计算，最后通过这个Hash码不同数值对应的数据区域进行分区。例如可以建立一个对表主键进行分区的表。<br>Key（键值）-上面Hash模式的一种延伸，这里的Hash Key是MySQL系统产生的。<br>List（预定义列表）–这种模式允许系统通过预定义的列表的值来对数据进行分割。<br>Composite（复合模式） –以上模式的组合使用　</p>
<h2 id="为什么要分区"><a href="#为什么要分区" class="headerlink" title="为什么要分区"></a>为什么要分区</h2><p>日常开发中我们经常会遇到大表的情况，所谓的大表是指存储了百万级乃至千万级条记录的表。这样的表过于庞大，导致数据库在查询和插入的时候耗时太长，性能低下，如果涉及联合查询的情况，性能会更加糟糕。分表和表分区的目的就是减少数据库的负担，提高数据库的效率，通常点来讲就是提高表的增删改查效率。</p>
<h3 id="分区的好处或者分区能解决什么问题"><a href="#分区的好处或者分区能解决什么问题" class="headerlink" title="分区的好处或者分区能解决什么问题"></a>分区的好处或者分区能解决什么问题</h3><ul>
<li>逻辑数据分割</li>
<li>提高单一的写和读应用速度</li>
<li>提高分区范围读查询的速度</li>
<li>分割数据能够有多个不同的物理文件路径</li>
<li>高效的保存历史数据</li>
<li>一个表上的约束检查</li>
<li>不同的主从服务器分区策略，例如master按Hash分区，slave按range分区</li>
</ul>
<h2 id="要分区的情况"><a href="#要分区的情况" class="headerlink" title="要分区的情况"></a>要分区的情况</h2><ul>
<li>海量数据表</li>
<li>历史表快速的查询，可以采用ARCHIVE+PARTITION的方式。</li>
<li>数据表索引大于服务器有效内存</li>
<li>对于大表，特别是索引远远大于服务器有效内存时，可以不用索引，此时分区效率会更有效。</li>
</ul>
<h2 id="分区实战"><a href="#分区实战" class="headerlink" title="分区实战"></a>分区实战</h2><p>建立两个表，一个按时间字段分区，一个不分区<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">CREATE TABLE `fenbiao_one` (</span><br><span class="line">  `id` int(11) NOT NULL,</span><br><span class="line">  `name` varchar(255) NOT NULL,</span><br><span class="line">  `insert_date` datetime  NOT NULL,</span><br><span class="line">) ENGINE=MyISAM DEFAULT CHARSET=utf8;</span><br><span class="line"></span><br><span class="line">ALTER TABLE fenbiao_one PARTITION by RANGE(`YEAR`(insert_date))</span><br><span class="line">(</span><br><span class="line">    PARTITION p1 VALUES LESS THAN (1996) , PARTITION p2 VALUES LESS THAN (1997) ,</span><br><span class="line"></span><br><span class="line">    PARTITION p3 VALUES LESS THAN (1998) , PARTITION p4 VALUES LESS THAN (1999) ,</span><br><span class="line"></span><br><span class="line">    PARTITION p5 VALUES LESS THAN (2000) , PARTITION p6 VALUES LESS THAN (2001) ,</span><br><span class="line"></span><br><span class="line">    PARTITION p7 VALUES LESS THAN (2002) , PARTITION p8 VALUES LESS THAN (2003) ,</span><br><span class="line"></span><br><span class="line">    PARTITION p9 VALUES LESS THAN (2004) , PARTITION p10 VALUES LESS THAN (2010),</span><br><span class="line"></span><br><span class="line">    PARTITION p11 VALUES LESS THAN MAXVALUE</span><br><span class="line">);</span><br><span class="line">CREATE TABLE `fenbiao_two` (</span><br><span class="line">   `id` int(11) NOT NULL,</span><br><span class="line">    `name` varchar(255) NOT NULL,</span><br><span class="line">    `insert_date` datetime  NOT NULL,</span><br><span class="line">) ENGINE=MyISAM DEFAULT CHARSET=utf8;</span><br></pre></td></tr></table></figure></p>
<h2 id="存储过程插入800万数据"><a href="#存储过程插入800万数据" class="headerlink" title="存储过程插入800万数据"></a>存储过程插入800万数据</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">CREATE PROCEDURE load_part_tab()  </span><br><span class="line">       begin  </span><br><span class="line">    <span class="built_in">declare</span> v int default 0;  </span><br><span class="line">    <span class="keyword">while</span> v &lt; 8000000  </span><br><span class="line">    <span class="keyword">do</span>  </span><br><span class="line">        insert into part_tab  </span><br><span class="line">        values (v,<span class="string">'testing partitions'</span>,adddate(<span class="string">'1995-01-01'</span>,(rand(v)*36520) mod 3652));  </span><br><span class="line">         <span class="built_in">set</span> v = v + 1;  </span><br><span class="line">    end <span class="keyword">while</span>;  </span><br><span class="line">    end</span><br></pre></td></tr></table></figure>
<p>插入分区的表<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">call insert_data_pro()</span><br></pre></td></tr></table></figure></p>
<p>插入不分区的表<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">insert into bufenqu_two select * from fenbiao_one</span><br></pre></td></tr></table></figure></p>
<h2 id="测试分表与不分区的性能"><a href="#测试分表与不分区的性能" class="headerlink" title="测试分表与不分区的性能"></a>测试分表与不分区的性能</h2><ul>
<li>分区的查询：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">        SELECT COUNT(*) from fenbiao_one <span class="built_in">where</span> insert_date &gt; DATE(<span class="string">'1995-01-01'</span>) and insert_date &lt; DATE(<span class="string">'1995-12-31'</span>)</span><br><span class="line"> ```   </span><br><span class="line">&gt;[SQL] SELECT COUNT(*) from fenbiao_one <span class="built_in">where</span> insert_date &gt; DATE(<span class="string">'1995-01-01'</span>) and insert_date &lt; DATE(<span class="string">'1995-12-31'</span>)</span><br><span class="line">受影响的行: 0</span><br><span class="line">时间: 0.249ms</span><br><span class="line"></span><br><span class="line">- 没有分区的查询</span><br><span class="line"></span><br><span class="line">        SELECT COUNT(*) from bufenqu_two <span class="built_in">where</span> insert_time &gt; DATE(<span class="string">'1995-01-01'</span>) and insert_time &lt; DATE(<span class="string">'1995-12-31'</span>)</span><br><span class="line">&gt;[SQL] SELECT COUNT(*) from bufenqu_two <span class="built_in">where</span> insert_time &gt; DATE(<span class="string">'1995-01-01'</span>) and insert_time &lt; DATE(<span class="string">'1995-12-31'</span>)</span><br><span class="line">受影响的行: 0</span><br><span class="line">时间: 2.395ms</span><br><span class="line"></span><br><span class="line">结果显示分区表比未分区表的执行事件减少90%</span><br><span class="line"></span><br><span class="line"><span class="comment">## 其他分区的例子</span></span><br><span class="line">- List 类型</span><br><span class="line">``` bash</span><br><span class="line"></span><br><span class="line">        CREATE TABLE category (  </span><br><span class="line">             cid INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,  </span><br><span class="line">             name VARCHAR(30) NOT NULL DEFAULT <span class="string">''</span>  </span><br><span class="line">        )  </span><br><span class="line">        PARTITION BY LIST (cid) (  </span><br><span class="line">             PARTITION p0 VALUES IN (0,4,8,12)  </span><br><span class="line">             DATA DIRECTORY = <span class="string">'/data0/data'</span>   </span><br><span class="line">             INDEX DIRECTORY = <span class="string">'/data1/idx'</span>,  </span><br><span class="line">               </span><br><span class="line">             PARTITION p1 VALUES IN (1,5,9,13)  </span><br><span class="line">             DATA DIRECTORY = <span class="string">'/data2/data'</span>  </span><br><span class="line">             INDEX DIRECTORY = <span class="string">'/data3/idx'</span>,  </span><br><span class="line">               </span><br><span class="line">             PARTITION p2 VALUES IN (2,6,10,14)  </span><br><span class="line">             DATA DIRECTORY = <span class="string">'/data4/data'</span>  </span><br><span class="line">             INDEX DIRECTORY = <span class="string">'/data5/idx'</span>,  </span><br><span class="line">               </span><br><span class="line">             PARTITION p3 VALUES IN (3,7,11,15)  </span><br><span class="line">             DATA DIRECTORY = <span class="string">'/data6/data'</span>  </span><br><span class="line">             INDEX DIRECTORY = <span class="string">'/data7/idx'</span>  </span><br><span class="line">        );</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>分成四个区，并且数据文件和索引文件单独存放</p>
<ul>
<li>HASH 类型     <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">CREATE TABLE users (  </span><br><span class="line">     uid INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,  </span><br><span class="line">     name VARCHAR(30) NOT NULL DEFAULT <span class="string">''</span>,  </span><br><span class="line">     email VARCHAR(30) NOT NULL DEFAULT <span class="string">''</span>  </span><br><span class="line">)  </span><br><span class="line">PARTITION BY HASH (uid) PARTITIONS 4 (  </span><br><span class="line">     PARTITION p0  </span><br><span class="line">     DATA DIRECTORY = <span class="string">'/data0/data'</span>  </span><br><span class="line">     INDEX DIRECTORY = <span class="string">'/data1/idx'</span>,  </span><br><span class="line">  </span><br><span class="line">     PARTITION p1  </span><br><span class="line">     DATA DIRECTORY = <span class="string">'/data2/data'</span>  </span><br><span class="line">     INDEX DIRECTORY = <span class="string">'/data3/idx'</span>,  </span><br><span class="line">  </span><br><span class="line">     PARTITION p2  </span><br><span class="line">     DATA DIRECTORY = <span class="string">'/data4/data'</span>  </span><br><span class="line">     INDEX DIRECTORY = <span class="string">'/data5/idx'</span>,  </span><br><span class="line">  </span><br><span class="line">     PARTITION p3  </span><br><span class="line">     DATA DIRECTORY = <span class="string">'/data6/data'</span>  </span><br><span class="line">     INDEX DIRECTORY = <span class="string">'/data7/idx'</span>  </span><br><span class="line">);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>分成四个区，并且数据文件和索引文件单独存放</p>
<ul>
<li>KEY 类型<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">        CREATE TABLE users (  </span><br><span class="line">             uid INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,  </span><br><span class="line">             name VARCHAR(30) NOT NULL DEFAULT <span class="string">''</span>,  </span><br><span class="line">             email VARCHAR(30) NOT NULL DEFAULT <span class="string">''</span>  </span><br><span class="line">        )  </span><br><span class="line">        PARTITION BY KEY (uid) PARTITIONS 4 (  </span><br><span class="line">             PARTITION p0  </span><br><span class="line">             DATA DIRECTORY = <span class="string">'/data0/data'</span>  </span><br><span class="line">             INDEX DIRECTORY = <span class="string">'/data1/idx'</span>,  </span><br><span class="line">               </span><br><span class="line">             PARTITION p1  </span><br><span class="line">             DATA DIRECTORY = <span class="string">'/data2/data'</span>   </span><br><span class="line">             INDEX DIRECTORY = <span class="string">'/data3/idx'</span>,  </span><br><span class="line">               </span><br><span class="line">             PARTITION p2   </span><br><span class="line">             DATA DIRECTORY = <span class="string">'/data4/data'</span>  </span><br><span class="line">             INDEX DIRECTORY = <span class="string">'/data5/idx'</span>,  </span><br><span class="line">               </span><br><span class="line">             PARTITION p3   </span><br><span class="line">             DATA DIRECTORY = <span class="string">'/data6/data'</span>  </span><br><span class="line">             INDEX DIRECTORY = <span class="string">'/data7/idx'</span>  </span><br><span class="line">        );     </span><br><span class="line">```        </span><br><span class="line"><span class="comment">## 子分区实战</span></span><br><span class="line">模拟需求：</span><br><span class="line">我们在淘宝的时候筛选商品的时候，经常会筛选多个条件一起查询，也就是联合查询，如图所示:</span><br><span class="line">![taobao](taobao.png)，接下来，我们设置一个文章表模拟使用分区进行根据分类以及时间进行联合查询，</span><br><span class="line"></span><br><span class="line"><span class="comment">### 创建一张文章表</span></span><br><span class="line">``` bash</span><br><span class="line"></span><br><span class="line">    CREATE TABLE `news_main` (</span><br><span class="line">      `id` int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">      `news_title` varchar(50) DEFAULT NULL,</span><br><span class="line">      `news_content` text,</span><br><span class="line">      `news_class` tinyint(4) DEFAULT NULL,</span><br><span class="line">      `news_click` int(11) DEFAULT NULL,</span><br><span class="line">      `news_adddate` datetime DEFAULT NULL,</span><br><span class="line">      PRIMARY KEY (`id`)</span><br><span class="line">    ) ENGINE=InnoDB AUTO_INCREMENT=6 DEFAULT CHARSET=utf8;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="手工插入一些数据"><a href="#手工插入一些数据" class="headerlink" title="手工插入一些数据"></a>手工插入一些数据</h3><h3 id="分区-1"><a href="#分区-1" class="headerlink" title="分区"></a>分区</h3></div><div class="tags"></div><div class="post-nav"><a class="pre" href="/2017/10/11/php-socket学习之旅-2/">php_socket学习之旅-2</a><a class="next" href="/2017/09/21/php的几种加密算法/">php的几种加密算法</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://blog.xhzyxed.cn"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/408/">408</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Nginx/">Nginx</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Redis/">Redis</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/docker/">docker</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/http/">http</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/javascript/">javascript</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/memcached/">memcached</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/mysql/">mysql</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/php/">php</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/vuejs/">vuejs</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/web安全/">web安全</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/前端构建工具/">前端构建工具</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/推文/">推文</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/项目/">项目</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/09/29/mysql优化之sql语句优化脑图/">mysql优化之sql语句优化脑图</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/29/mysql事务/">mysql事务</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/29/mysql表分区/">mysql表分区</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/29/mysql主从读写分离/">mysql主从读写分离</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/29/mysql主主复制/">mysql主主复制</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/28/mysql主从复制/">mysql主从复制</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/28/使用docker部署快速部署wordpress/">使用docker部署快速部署wordpress</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/27/mysql优化之in和exists/">mysql优化之in,exists,count,group by和union</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/26/mysql优化之学习explain分析sql语句/">mysql优化之学习explain分析sql语句</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/26/mysql优化之索引学习脑图/">mysql优化之索引学习脑图</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://org.xhzyxed.cn/" title="小猴子与小耳朵" target="_blank">小猴子与小耳朵</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">其斤.匕禾页.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>