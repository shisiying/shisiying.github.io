<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="努力，奋斗！"><title>mysql-4 sql的优化-explian以及分页查询优化 | 其斤.匕禾页</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">mysql-4 sql的优化-explian以及分页查询优化</h1><a id="logo" href="/.">其斤.匕禾页</a><p class="description">站在巨人的肩膀上，做只勤奋的小蜜蜂！</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/2018/10/02/lnmp技术栈文章汇总/"><i class="fa fa-archive"> LNMP技术栈</i></a><a href="/2018/10/02/速读laravel源码/"><i class="fa fa-archive"> laravel框架学习</i></a><a href="https://zhimap.com/mmap/773f7025d57f4c24b3c680bd9972c7e8"><i class="fa fa-archive"> 秒杀系统学习</i></a><a href="/2018/09/22/408基础/"><i class="fa fa-archive"> 计算机基础</i></a><a href="/2018/09/17/resume/"><i class="fa fa-user"> 关于</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">mysql-4 sql的优化-explian以及分页查询优化</h1><div class="post-meta">Sep 17, 2017<span> | </span><span class="category"><a href="/categories/mysql/">mysql</a></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#explain的妙用"><span class="toc-number">1.</span> <span class="toc-text">explain的妙用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#建表"><span class="toc-number">1.1.</span> <span class="toc-text">建表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#插入一百万数据"><span class="toc-number">1.2.</span> <span class="toc-text">插入一百万数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#explain的type指标"><span class="toc-number">1.3.</span> <span class="toc-text">explain的type指标</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#大数据下商品数据的分页"><span class="toc-number">1.4.</span> <span class="toc-text">大数据下商品数据的分页</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#问题"><span class="toc-number">1.4.1.</span> <span class="toc-text">问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#优化"><span class="toc-number">1.4.2.</span> <span class="toc-text">优化</span></a></li></ol></li></ol></li></ol></div></div><div class="post-content"><p>在查询大数据表编写查询语句的时候，我们需要对我们编写的sql语句有一个性能了解，这时候我们需要使用到explain对sql语句进行检测。<br><a id="more"></a></p>
<h1 id="explain的妙用"><a href="#explain的妙用" class="headerlink" title="explain的妙用"></a>explain的妙用</h1><h2 id="建表"><a href="#建表" class="headerlink" title="建表"></a>建表</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `prod_main` (</span><br><span class="line">    `id` int(11) NOT NULL AUTO_INCREMENT COMMENT <span class="string">'商品id'</span>,</span><br><span class="line">    `prod_name` varchar(50) NOT NULL COMMENT <span class="string">'商品名称'</span>,</span><br><span class="line">    `prod_classid` int(11) NOT NULL COMMENT <span class="string">'商品分类'</span>,</span><br><span class="line">    `prod_intr` text COMMENT <span class="string">'商品简介'</span>,</span><br><span class="line">    `prod_adddate` timestamp NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT <span class="string">'添加时间'</span>,</span><br><span class="line">    `prod_lastupdate` timestamp NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT <span class="string">'上次更新时间'</span>,</span><br><span class="line">    `prod_click_all` int(11) DEFAULT <span class="string">'0'</span> COMMENT <span class="string">'总点击量'</span>,</span><br><span class="line">    `prod_click_month` int(11) DEFAULT <span class="string">'0'</span> COMMENT <span class="string">'月点击量'</span>,</span><br><span class="line">    `prod_sale_all` int(11) DEFAULT <span class="string">'0'</span>,</span><br><span class="line">    `prod_sale_month` int(11) DEFAULT <span class="string">'0'</span>,</span><br><span class="line">    `prod_com_all` int(11) DEFAULT <span class="string">'0'</span> COMMENT <span class="string">'总评价数'</span>,</span><br><span class="line">    `prod_com_month` int(11) DEFAULT <span class="string">'0'</span> COMMENT <span class="string">'月评价数'</span>,</span><br><span class="line">    PRIMARY KEY (`id`)</span><br><span class="line">  ) ENGINE=MyISAM DEFAULT CHARSET=utf8;</span><br></pre></td></tr></table></figure>
<h2 id="插入一百万数据"><a href="#插入一百万数据" class="headerlink" title="插入一百万数据"></a>插入一百万数据</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">CREATE PROCEDURE sp_insert_goods()</span><br><span class="line">BEGIN</span><br><span class="line">                        <span class="built_in">set</span> @num=1;</span><br><span class="line">            WHILE @num&lt;1000000 DO</span><br><span class="line">                INSERT INTO prod_main(prod_name,prod_classid,prod_intr)VALUES(CONCAT(<span class="string">'商品'</span>,@num),@num,<span class="string">'</span></span><br><span class="line"><span class="string">秋冬日系彩点毛衣男套头羊毛衫男青年修身打底衫常规圆领针织衫男</span></span><br><span class="line"><span class="string">特别有设计性的一款毛衣，羊毛混纺面料，羊毛含量达到30%，兼顾保暖和性价比。面料采用混色彩点的设计，手臂的“8”字扭花源自爱尔兰传统服饰，在时尚界，这种“8”字扭花织法的毛衣学名叫做“渔夫毛衣”，有代表学院风的，有Da牌时尚款的，绞花混色毛衣传递着时尚信号，是随意、自信、而又具品位'</span>);</span><br><span class="line">                SET @num=@num+1;</span><br><span class="line">            END WHILE;</span><br><span class="line">END</span><br></pre></td></tr></table></figure>
<h2 id="explain的type指标"><a href="#explain的type指标" class="headerlink" title="explain的type指标"></a>explain的type指标</h2><p>explain命令用于分析sql语句的执行情况和成本预估<br>type表示标的连接类型，指标表明语句的性能执行情况，按照官方给出的指标，由好到坏依次是:<br>system(表中仅有一行，即常量表)、const(单表中最多有一个匹配行，例如primary key或者unique index)、eq_ref(对于前面的每一行，在此表中只查询一条记录，简单点来说，就是夺标连接中使用primary key 或者unique index)、ref(使用普通的索引)、ref_or_null（与 ref 类似，区别在于<br>条件中包含对 NULL 的查询）、index_merge(索引合并优化)、unique_subquery（in的后面是一个查询主键字段的子查询）、index_subquery（与 unique_subquery 类似，区别在于 in 的后面是查询非唯一索引字段的子查询）、range（单表中的范围查询）、<br>index（对于前面的每一行，都通过查询索引来得到数据）、all（对于前面的每一行都通过权标来得到数据）</p>
<p>根据这些指标以及其他key值，我们给表建索引和其他优化措施</p>
<h2 id="大数据下商品数据的分页"><a href="#大数据下商品数据的分页" class="headerlink" title="大数据下商品数据的分页"></a>大数据下商品数据的分页</h2><h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p>简单的查询:使用limit<br><img src="beforefenye.png" alt=""><br>再来一个劲爆的<br><img src="fenye.png" alt=""><br>数据量一大，如果不优化一下，那真的是急死人了，翻一页就要等好久</p>
<h3 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CREATE PROCEDURE sp_fenyeyouhua(IN startRow int,IN pagesize int)</span><br><span class="line">BEGIN</span><br><span class="line">    <span class="comment">#Routine body goes here...</span></span><br><span class="line">        SELECT * from prod_main <span class="built_in">where</span> id&lt;=(select id from prod_main ORDER BY id desc <span class="built_in">limit</span> startRow,1) ORDER BY id DESC LIMIT pagesize;</span><br><span class="line">END</span><br></pre></td></tr></table></figure>
<p>执行同样的功能<br><img src="fenyeafter.png" alt=""><br>对比很明显，同一台机器，优化措施见效快，疗效好！</p>
</div><div class="tags"></div><div class="post-nav"><a class="pre" href="/2017/09/20/websocket的学习笔记/">websocket的学习笔记</a><a class="next" href="/2017/09/14/用户充值功能的实现/">mysql-3 用户充值与转账功能的实现</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://blog.xhzyxed.cn"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/408/">408</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Nginx/">Nginx</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Redis/">Redis</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/docker/">docker</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/http/">http</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/javascript/">javascript</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/memcached/">memcached</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/mysql/">mysql</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/php/">php</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/vuejs/">vuejs</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/web安全/">web安全</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/前端构建工具/">前端构建工具</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/推文/">推文</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/项目/">项目</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/10/17/laravel学习之路由/">laravel学习之路由</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/14/laravel学习之中间件/">laravel学习之中间件</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/11/laravel学习之Facades/">laravel学习之Facades</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/10/laravel学习之服务提供者/">laravel学习之服务提供者</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/09/laravel学习之服务容器/">laravel学习之服务容器</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/09/laravel请求到响应的整个过程/">laravel请求到响应的整个过程</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/09/​类的反射和依赖注入/">​类的反射和依赖注入</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/06/秒杀系统学习/">秒杀系统学习</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/06/laravel框架学习之涉及到的设计模式/">laravel框架学习之重要的设计模式</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/06/laravel框架学习之需要了解的php基础/">laravel框架学习之需要了解的php基础</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://org.xhzyxed.cn/" title="小猴子与小耳朵" target="_blank">小猴子与小耳朵</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">其斤.匕禾页.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>